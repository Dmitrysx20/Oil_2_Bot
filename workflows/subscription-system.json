{
  "name": "–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "subscription-inquiry-condition",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "subscription_inquiry",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [1280, -144],
      "id": "if-subscription-inquiry",
      "name": "IF Subscription Inquiry"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ –ø–æ–¥–ø–∏—Å–∫–µ\nconst input = $input.first();\nconst request = input.json;\nconst chatId = request.chatId;\nconst keyword = request.keywords?.[0] || '';\nconst originalText = request.originalText;\n\nconsole.log('üîî Processing subscription request:', keyword, 'for user:', chatId);\n\n// –ê–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nfunction analyzeSubscriptionIntent(text, keyword) {\n  const normalized = text.toLowerCase();\n  \n  if (keyword.includes('–ø–æ–¥–ø–∏—Å') && !keyword.includes('–æ—Ç–ø–∏—Å')) {\n    return 'subscribe';\n  } else if (keyword.includes('–æ—Ç–ø–∏—Å') || keyword.includes('–æ—Ç–∫–ª—é—á')) {\n    return 'unsubscribe';\n  } else if (keyword.includes('–Ω–∞—Å—Ç—Ä–æ–π–∫') || keyword.includes('–≤—Ä–µ–º—è')) {\n    return 'settings';\n  } else if (keyword.includes('–ø–æ–ª—É—á–∞—Ç—å') || keyword.includes('—É–≤–µ–¥–æ–º–ª–µ–Ω')) {\n    return 'info_request';\n  }\n  \n  return 'subscribe'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–æ–¥–ø–∏—Å–∫–∞\n}\n\nconst intent = analyzeSubscriptionIntent(originalText, keyword);\nconsole.log('üéØ Detected intent:', intent);\n\nswitch(intent) {\n  case 'subscribe':\n    return [{\n      json: {\n        action: 'subscription_offer',\n        chatId: chatId,\n        message: `üîî **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏**\n\nüì¢ **–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:**\nüåÖ **–£—Ç—Ä–æ–º (9:00):** –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∏—á–Ω–æ–≥–æ –¥–Ω—è\nüåô **–í–µ—á–µ—Ä–æ–º (20:00):** –†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Å–æ–≤–µ—Ç—ã –∏ –º—É–∑—ã–∫–∞  \nüéµ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã** —Å –ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏ —ç—Ñ–∏—Ä–Ω—ã–º–∏ –º–∞—Å–ª–∞–º–∏\nüìö **–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã** –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n\n‚ö° **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**\n‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ\n‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏\n‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º–∞ \"21 –¥–µ–Ω—å —Å –º–∞—Å–ª–∞–º–∏\"  \n‚Ä¢ –û—Ç–ø–∏—Å–∫–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç\n\nüí° **–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!**\n\nüìù **–î–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞–ø–∏—à–∏—Ç–µ:** \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"\nüìù **–£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ\"\nüìù **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º—è:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏\"\nüìù **–û—Ç–º–µ–Ω–∞:** \"–Ω–µ —Å–µ–π—á–∞—Å\"`,\n        subscriptionData: {\n          intent: intent,\n          originalKeyword: keyword,\n          nextSteps: ['–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', '—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏', '–Ω–µ —Å–µ–π—á–∞—Å']\n        }\n      }\n    }];\n\n  case 'unsubscribe':\n    return [{\n      json: {\n        action: 'unsubscribe_confirmation',\n        chatId: chatId,\n        message: `üòî **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤?\n\nüíî **–í—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:**\n‚Ä¢ –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–∞—Å–µ–ª\n‚Ä¢ –í–µ—á–µ—Ä–Ω–∏–µ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Å–æ–≤–µ—Ç—ã\n‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥–±–æ—Ä–∫–∏\n‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n\nüí° **–í–∞—Ä–∏–∞–Ω—Ç—ã:**\n\nüìù **–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é:** \"–¥–∞, –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è\"\nüìù **–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** \"–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\"  \nüìù **–ü–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é:** \"–ø–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é\"\nüìù **–ü–µ—Ä–µ–¥—É–º–∞–ª:** \"–ø–µ—Ä–µ–¥—É–º–∞–ª\"`,\n        subscriptionData: {\n          intent: intent,\n          nextSteps: ['–¥–∞, –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è', '–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', '–ø–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é', '–ø–µ—Ä–µ–¥—É–º–∞–ª']\n        }\n      }\n    }];\n\n  case 'settings':\n    return [{\n      json: {\n        action: 'subscription_settings',\n        chatId: chatId,\n        message: `‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\nüïò **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**\nüåÖ –£—Ç—Ä–æ–º: 9:00 –ú–°–ö ‚úÖ\nüåô –í–µ—á–µ—Ä–æ–º: 20:00 –ú–°–ö ‚úÖ\nüéµ –ú—É–∑—ã–∫–∞: –≤–∫–ª—é—á–µ–Ω–∞ ‚úÖ\nüåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: Europe/Moscow\n\nüéõÔ∏è **–ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:**\n\nüìù **–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è:** \"–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è\"\nüìù **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏\"\nüìù **–¢–æ–ª—å–∫–æ —É—Ç—Ä–æ–º:** \"—Ç–æ–ª—å–∫–æ —É—Ç—Ä–æ–º\"\nüìù **–¢–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º:** \"—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º\"  \nüìù **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:** \"—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å\"\nüìù **–í—Å—ë –≥–æ—Ç–æ–≤–æ:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã\"`,\n        subscriptionData: {\n          intent: intent,\n          nextSteps: ['–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏', '—Ç–æ–ª—å–∫–æ —É—Ç—Ä–æ–º', '—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º', '—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã']\n        }\n      }\n    }];\n\n  default:\n    return [{\n      json: {\n        action: 'subscription_error',\n        chatId: chatId,\n        message: `ü§î –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å –æ –ø–æ–¥–ø–∏—Å–∫–µ.\n\nüí° **–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å:**\n\nüìù **–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è:** \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–≤–µ—Ç—ã\"\nüìù **–û—Ç–ø–∏—Å–∞—Ç—å—Å—è:** \"–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\"\nüìù **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏\"\nüìù **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ\"\n\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω—É –∏–∑ —Ñ—Ä–∞–∑ –≤—ã—à–µ! üòä`,\n        subscriptionData: {\n          intent: 'unknown',\n          originalText: originalText,\n          nextSteps: ['–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–≤–µ—Ç—ã', '–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ']\n        }\n      }\n    }];\n}\n\n// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\nconsole.log('üìä Subscription request processed:', {\n  chatId: chatId,\n  intent: intent,\n  keyword: keyword,\n  timestamp: new Date().toISOString()\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2080, -1296],
      "id": "subscription-handler",
      "name": "Subscription Handler"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "subscription-confirmation-condition",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "subscription_confirmation",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [1280, -1040],
      "id": "if-subscription-confirmation",
      "name": "IF Subscription Confirmation"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –ø–æ–¥–ø–∏—Å–∫–∏\nconst input = $input.first();\nconst request = input.json;\nconst chatId = request.chatId;\nconst userName = request.userName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';\nconst confirmationType = request.confirmationType;\nconst matchedPattern = request.matchedPattern;\n\nconsole.log('‚úÖ Processing confirmation:', confirmationType, 'for user:', chatId);\n\nswitch(confirmationType) {\n  case 'confirm_subscribe':\n    return [{\n      json: {\n        action: 'subscription_confirmed',\n        chatId: chatId,\n        message: `üéâ **–û—Ç–ª–∏—á–Ω–æ, ${userName}! –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å!**\n\n‚úÖ **–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:**\nüåÖ **–£—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–≤–µ—Ç—ã** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 –ú–°–ö\nüåô **–í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 20:00 –ú–°–ö\nüéµ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã** —Å —ç—Ñ–∏—Ä–Ω—ã–º–∏ –º–∞—Å–ª–∞–º–∏\n\nüöÄ **–ß—Ç–æ –¥–∞–ª—å—à–µ?**\n‚Ä¢ –ó–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Å–æ–≤–µ—Ç\n‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ \"–º—É–∑—ã–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\" –¥–ª—è –ø—Ä–æ–±–Ω–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏\" –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏\n\nüí° **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\nüìù \"—Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏\" - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nüìù \"–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è\" - –æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  \nüìù \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏\" - –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\n\nüåø **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏!**`,\n        subscriptionData: {\n          status: 'active',\n          subscribedAt: new Date().toISOString(),\n          preferences: {\n            morning_enabled: true,\n            evening_enabled: true,\n            morning_time: '09:00',\n            evening_time: '20:00',\n            timezone: 'Europe/Moscow',\n            music_enabled: true\n          }\n        }\n      }\n    }];\n    \n  case 'confirm_unsubscribe':\n    return [{\n      json: {\n        action: 'unsubscription_confirmed',\n        chatId: chatId,\n        message: `üòî **–ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞**\n\n–í—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.\n\nüíô **–ú—ã –±—É–¥–µ–º —Å–∫—É—á–∞—Ç—å, ${userName}!** \n\nüîÑ **–í—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è:**\nüìù –ù–∞–ø–∏—à–∏—Ç–µ \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\" –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\n\nüåø **–Ø –≤—Å—ë –µ—â—ë –º–æ–≥—É –ø–æ–º–æ—á—å —Å –º–∞—Å–ª–∞–º–∏!**\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ –º–∞—Å–ª–æ\n‚Ä¢ –û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ  \n‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n–£–¥–∞—á–∏ –≤–∞–º! üçÄ`,\n        subscriptionData: {\n          status: 'unsubscribed',\n          unsubscribedAt: new Date().toISOString()\n        }\n      }\n    }];\n\n  case 'cancel_action':\n    return [{\n      json: {\n        action: 'action_cancelled',\n        chatId: chatId,\n        message: `üëå **–•–æ—Ä–æ—à–æ, ${userName}!**\n\n–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ - —è –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å. üòä\n\nüåø **–ê –ø–æ–∫–∞ –º–æ–≥—É –ø–æ–º–æ—á—å —Å –º–∞—Å–ª–∞–º–∏:**\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ –º–∞—Å–ª–æ\n‚Ä¢ –û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É\n‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\" –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã\n\nüí° **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**\nüìù \"–ª–∞–≤–∞–Ω–¥–∞\" - —É–∑–Ω–∞—Ç—å –ø—Ä–æ –º–∞—Å–ª–æ –ª–∞–≤–∞–Ω–¥—ã\nüìù \"—Å—Ç—Ä–µ—Å—Å\" - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞\nüìù \"–º—É–∑—ã–∫–∞ –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è\" - –ø–æ–ª—É—á–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç`,\n        subscriptionData: {\n          actionCancelled: true,\n          cancelledAt: new Date().toISOString()\n        }\n      }\n    }];\n\n  default:\n    return [{\n      json: {\n        action: 'unknown_confirmation',\n        chatId: chatId,\n        message: `ü§î **–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å**\n\n–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\nüìù **–ù–∞–ø–∏—à–∏—Ç–µ:** \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"\n\n–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ:\nüìù **–ù–∞–ø–∏—à–∏—Ç–µ:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ\"\n\n–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ —ç—Ñ–∏—Ä–Ω–æ–µ –º–∞—Å–ª–æ! üåø`,\n        subscriptionData: {\n          confirmationType: confirmationType,\n          originalPattern: matchedPattern,\n          needsManualReview: true\n        }\n      }\n    }];\n}\n\n// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\nconsole.log('üìä Subscription confirmation processed:', {\n  chatId: chatId,\n  confirmationType: confirmationType,\n  matchedPattern: matchedPattern,\n  userName: userName,\n  timestamp: new Date().toISOString()\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2064, -1056],
      "id": "subscription-confirmation-handler",
      "name": "Subscription Confirmation Handler"
    },
    {
      "parameters": {
        "operation": "upsert",
        "tableId": "subscribers",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "chat_id",
              "fieldValue": "={{ $json.chatId }}"
            },
            {
              "fieldId": "first_name",
              "fieldValue": "={{ $json.userName }}"
            },
            {
              "fieldId": "is_active",
              "fieldValue": "={{ $json.subscriptionData.status === 'active' ? 'true' : 'false' }}"
            },
            {
              "fieldId": "subscription_date",
              "fieldValue": "={{ $json.subscriptionData.subscribedAt || new Date().toISOString() }}"
            },
            {
              "fieldId": "preferences",
              "fieldValue": "={{ JSON.stringify($json.subscriptionData.preferences || {}) }}"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [2288, -1296],
      "id": "update-subscriber",
      "name": "Update Subscriber",
      "credentials": {
        "supabaseApi": {
          "id": "supabase-credentials",
          "name": "Supabase"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "disable_web_page_preview": true
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [2576, -1328],
      "id": "telegram-subscription-response",
      "name": "Telegram Subscription Response",
      "webhookId": "subscription-webhook",
      "credentials": {
        "telegramApi": {
          "id": "telegram-credentials",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [2528, -1056],
      "id": "telegram-confirmation-response",
      "name": "Telegram Confirmation Response",
      "webhookId": "confirmation-webhook",
      "credentials": {
        "telegramApi": {
          "id": "telegram-credentials",
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "IF Subscription Inquiry": {
      "main": [
        [
          {
            "node": "Subscription Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Subscription Handler": {
      "main": [
        [
          {
            "node": "Update Subscriber",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Subscriber": {
      "main": [
        [
          {
            "node": "Telegram Subscription Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Subscription Confirmation": {
      "main": [
        [
          {
            "node": "Subscription Confirmation Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Subscription Confirmation Handler": {
      "main": [
        [
          {
            "node": "Telegram Confirmation Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "subscription-system-v1",
  "id": "subscription-system-workflow"
} 