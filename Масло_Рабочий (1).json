{
  "name": "–ú–∞—Å–ª–æ_–†–∞–±–æ—á–∏–π",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        384,
        -144
      ],
      "id": "8ec4529c-3e3c-4edb-953f-9315240d76f9",
      "name": "Telegram Trigger",
      "webhookId": "ba91aeff-e57e-4f70-9712-28f5dc1d4964",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Smart Router').first().json.chatId }}",
        "text": "={{(() => {\n  if ($json.error) {\n    const suggestions = $json.suggestions || [];\n    const searchedName = $json.searchedName || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –º–∞—Å–ª–æ';\n    \n    let message = `üîç –ù–µ –Ω–∞—à–µ–ª –º–∞—Å–ª–æ \"${searchedName}\".\\n\\n`;\n    \n    if (suggestions.length > 0) {\n      message += `üí° –í–æ–∑–º–æ–∂–Ω–æ, —Ç—ã –∏—Å–∫–∞–ª:\\n`;\n      suggestions.slice(0, 5).forEach(suggestion => {\n        message += `‚Ä¢ ${suggestion}\\n`;\n      });\n      message += '\\n';\n    }\n    \n    message += `üéØ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–∫–∞—Ç—å:\\n`;\n    message += `‚Ä¢ –ü—Ä–æ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ: \"–ª–∞–≤–∞–Ω–¥–∞\", \"–º—è—Ç–∞\"\\n`;\n    message += `‚Ä¢ –° –∫–æ–º–∞–Ω–¥–æ–π: \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ —ç–≤–∫–∞–ª–∏–ø—Ç\"\\n`;\n    message += `‚Ä¢ –ü–æ —ç—Ñ—Ñ–µ–∫—Ç—É: \"–Ω—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è\", \"—Ö–æ—á—É —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è\"`;\n    \n    return message;\n  }\n  \n  let message = `üåø ${$json.oil_name}\\n${$json.description}\\n\\n`;\n  message += `üß† –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç:\\n${$json.emotional_effect}\\n\\n`;\n  message += `üí™ –§–∏–∑–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç:\\n${$json.physical_effect}\\n\\n`;\n  message += `üß¥ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:\\n${$json.applications}\\n\\n`;\n  message += `‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ:\\n${$json.safety_warning}\\n\\n`;\n  \n  if ($json.keywords) {\n    message += `üè∑Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞: ${$json.keywords}\\n\\n`;\n  }\n  \n  message += `üòÑ –ö—Å—Ç–∞—Ç–∏:\\n${$json.joke}`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "=main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2240,
        -320
      ],
      "id": "0aad1271-f4cc-49f5-b197-46762bca2d34",
      "name": "Telegram Sender",
      "webhookId": "63ba91f1-e2e4-439b-9304-62bb76a7925c",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –£–ª—É—á—à–µ–Ω–Ω—ã–π Filter Matching Oil –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å 120 –º–∞—Å–ª–∞–º–∏\nconst supabaseResults = $input.all();\n\nconsole.log('=== SUPABASE NATIVE NODE RESULTS ===');\nconsole.log('Total results:', supabaseResults.length);\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç Smart Router\nconst smartRouterData = $('Smart Router').first().json;\nconsole.log('Smart Router data:', smartRouterData);\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç Supabase\nif (!Array.isArray(supabaseResults) || supabaseResults.length === 0) {\n  console.log('‚ùå No results from Supabase');\n  \n  // –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞\n  const originalQuery = smartRouterData.oilName || smartRouterData.originalText || '';\n  const suggestions = getSuggestions(originalQuery);\n  \n  return [{\n    json: {\n      error: \"–ú–∞—Å–ª–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ\",\n      searchedName: smartRouterData.normalizedOilName || originalQuery,\n      originalQuery: smartRouterData.oilName || originalQuery,\n      chatId: smartRouterData.chatId,\n      debug: {\n        supabaseResults: supabaseResults.length,\n        searchedFor: smartRouterData.normalizedOilName,\n        detectedCommand: smartRouterData.detectedCommand\n      },\n      suggestions: suggestions\n    }\n  }];\n}\n\n// –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –±–ª–∞–≥–æ–¥–∞—Ä—è —Ñ–∏–ª—å—Ç—Ä—É)\nconst foundOil = supabaseResults[0].json;\nconsole.log('‚úÖ Found oil:', foundOil.oil_name);\nconsole.log('Oil data keys:', Object.keys(foundOil));\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É –º–∞—Å–ª–∞ –µ—Å—Ç—å –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è\nconst requiredFields = ['oil_name', 'description', 'emotional_effect', 'physical_effect', 'applications', 'safety_warning', 'joke'];\nconst missingFields = requiredFields.filter(field => !foundOil[field]);\n\nif (missingFields.length > 0) {\n  console.log('‚ö†Ô∏è Missing fields:', missingFields);\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –º–∞—Å–ª–æ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏\nreturn [{\n  json: {\n    // –í—Å–µ –ø–æ–ª—è –º–∞—Å–ª–∞\n    oil_name: foundOil.oil_name,\n    description: foundOil.description,\n    emotional_effect: foundOil.emotional_effect,\n    physical_effect: foundOil.physical_effect,\n    applications: foundOil.applications,\n    safety_warning: foundOil.safety_warning,\n    joke: foundOil.joke,\n    keywords: foundOil.keywords,\n    \n    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\n    chatId: smartRouterData.chatId,\n    searchType: 'direct',\n    foundBy: 'native_supabase_filter',\n    searchedFor: smartRouterData.normalizedOilName,\n    originalQuery: smartRouterData.oilName,\n    detectedCommand: smartRouterData.detectedCommand,\n    \n    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n    debug: {\n      foundOilName: foundOil.oil_name,\n      totalResults: supabaseResults.length,\n      hasAllFields: missingFields.length === 0,\n      searchMethod: 'exact_match'\n    }\n  }\n}];\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–º–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π\nfunction getSuggestions(query) {\n  const lowerQuery = query.toLowerCase();\n  \n  // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º\n  const popularOils = {\n    citrus: ['–õ–∏–º–æ–Ω', '–î–∏–∫–∏–π –∞–ø–µ–ª—å—Å–∏–Ω', '–ì—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–õ–∞–π–º', '–ë–µ—Ä–≥–∞–º–æ—Ç'],\n    relaxing: ['–õ–∞–≤–∞–Ω–¥–∞', '–†–æ–º–∞—à–∫–∞', '–ò–ª–∞–Ω–≥-–∏–ª–∞–Ω–≥', '–ë–∞–ª–∞–Ω—Å', '–í–∏—Å–ø–µ—Ä'],\n    energizing: ['–ú—è—Ç–∞ –ø–µ—Ä–µ—á–Ω–∞—è', '–†–æ–∑–º–∞—Ä–∏–Ω', '–≠–≤–∫–∞–ª–∏–ø—Ç', '–ú–æ—Ç–∏–≤–µ–π—Ç', '–ß–∏—Ä'],\n    healing: ['–ß–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ', '–õ–∞–¥–∞–Ω', '–ì–µ–ª–∏—Ö—Ä–∏–∑—É–º', '–ú–µ–ª–∞–ª–µ—É–∫–∞', '–°—Ç—Ä–æ–Ω–≥–µ—Ä'],\n    blends: ['–î–∞–π–¥–∂–µ—Å—Ç–ó–µ–Ω', '–ò–∑–∏ –≠–π—Ä', '–î–∏–ø –ë–ª—É', '–°–∏—Ç—Ä—É—Å –ë–ª–∏—Å—Å', '–ê—Ä–æ–º–∞–¢–∞—á']\n  };\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –∑–∞–ø—Ä–æ—Å—É\n  if (/—Ü–∏—Ç—Ä—É—Å|–∞–ø–µ–ª—å—Å–∏–Ω|–ª–∏–º–æ–Ω|–ª–∞–π–º|—Å–≤–µ–∂/.test(lowerQuery)) {\n    return popularOils.citrus.map(oil => `–ü–æ–ø—Ä–æ–±—É–π: \"${oil}\"`);\n  }\n  \n  if (/—Å–ø–æ–∫–æ–π|—Ä–µ–ª–∞–∫—Å|—Å–æ–Ω|—Ä–∞—Å—Å–ª–∞–±|—Å—Ç—Ä–µ—Å—Å/.test(lowerQuery)) {\n    return popularOils.relaxing.map(oil => `–ü–æ–ø—Ä–æ–±—É–π: \"${oil}\"`);\n  }\n  \n  if (/—ç–Ω–µ—Ä–≥|–±–æ–¥—Ä|–∞–∫—Ç–∏–≤|–º–æ—Ç–∏–≤|—Å–∏–ª/.test(lowerQuery)) {\n    return popularOils.energizing.map(oil => `–ü–æ–ø—Ä–æ–±—É–π: \"${oil}\"`);\n  }\n  \n  if (/–ª–µ—á–µ–Ω|–∑–¥–æ—Ä–æ–≤|–±–æ–ª–µ–∑–Ω|–ø—Ä–æ—Å—Ç—É–¥|–ª–µ—á–∏—Ç/.test(lowerQuery)) {\n    return popularOils.healing.map(oil => `–ü–æ–ø—Ä–æ–±—É–π: \"${oil}\"`);\n  }\n  \n  if (/—Å–º–µ—Å—å|–±–ª–µ–Ω|–∫–æ–º–ø–ª–µ–∫—Å/.test(lowerQuery)) {\n    return popularOils.blends.map(oil => `–ü–æ–ø—Ä–æ–±—É–π: \"${oil}\"`);\n  }\n  \n  // –ë–∞–∑–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è\n  return [\n    '–ü–æ–ø—Ä–æ–±—É–π: \"–õ–∞–≤–∞–Ω–¥–∞\" - –¥–ª—è —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è',\n    '–ü–æ–ø—Ä–æ–±—É–π: \"–ú—è—Ç–∞ –ø–µ—Ä–µ—á–Ω–∞—è\" - –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏', \n    '–ü–æ–ø—Ä–æ–±—É–π: \"–õ–∏–º–æ–Ω\" - –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è',\n    '–ò–ª–∏ –Ω–∞–ø–∏—à–∏: \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ —ç–≤–∫–∞–ª–∏–ø—Ç\"',\n    '–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ: \"–Ω—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è\"'\n  ];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1984,
        -288
      ],
      "id": "d89e8473-39e8-4c72-8289-9648127373a1",
      "name": "Filter Matching Oil"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "üåø **–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ê—Ä–æ–º–∞-–ø–æ–º–æ—â–Ω–∏–∫!** üåø\n\n‚ú® **–ß—Ç–æ —è —É–º–µ—é:**\n\nüîç **–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ –ª—é–±–æ–µ –º–∞—Å–ª–æ:**\n- –ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏: \"–º—è—Ç–∞\", \"–ª–∞–≤–∞–Ω–¥–∞\", \"–ª–∏–º–æ–Ω\"\n- –ò–ª–∏: \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ —ç–≤–∫–∞–ª–∏–ø—Ç\"\n\nü§ñ **–î–∞—Ç—å –Ω–∞—É—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**\n- \"–Ω—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è\" ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º–∏\n- \"—Ö–æ—á—É —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è\" ‚Üí —Å–æ–≤–µ—Ç—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤\n- \"–ø—Ä–æ—Å—Ç—É–¥–∞\" ‚Üí –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ª–µ—á–µ–Ω–∏–∏\n\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —á—Ç–æ —Ç–µ–±—è –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç! üòä",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2048,
        192
      ],
      "id": "5881624b-753c-45d4-a446-d4d63d298700",
      "name": "Default Response",
      "webhookId": "dd82cb6a-a1f9-4c17-bb5b-240bd4192437",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "24706d2b-aaba-4878-b6cd-66ddbf0c1959",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "direct_search",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1552,
        -144
      ],
      "id": "2262bde3-8570-4980-8797-d874c34e5632",
      "name": "IF Direct Search"
    },
    {
      "parameters": {
        "jsCode": "// üß† SMART ROUTER v2.1 - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø \nconst input = $input.first();\n\n// ========== –ü–†–û–í–ï–†–ö–ê –í–•–û–î–ù–´–• –î–ê–ù–ù–´–• ==========\nif (!input || !input.json) {\n  console.log('‚ùå No input data received');\n  return [{\n    json: {\n      originalText: '',\n      normalizedText: '',\n      requestType: 'default',\n      chatId: 'unknown',\n      error: 'No input data'\n    }\n  }];\n}\n\nconsole.log('üì® Full input received:', JSON.stringify(input.json, null, 2));\n\n// ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–û–í–´–• –ü–ï–†–ï–ú–ï–ù–ù–´–• ==========\nlet rawText = '';\nlet chatId = 'unknown';\nlet userName = '';\nlet callbackData = '';\n\n// ========== –û–ë–†–ê–ë–û–¢–ö–ê CALLBACK QUERIES ==========\nconst isCallback = input?.json?.callback_query ? true : false;\n\nif (isCallback) {\n  callbackData = input.json.callback_query.data || '';\n  chatId = input.json.callback_query.message.chat.id;\n  userName = input.json.callback_query.from.first_name || 'User';\n  rawText = `callback:${callbackData}`;\n  \n  console.log('üîò Callback received:', callbackData);\n  \n  // Callback –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫\n  if (callbackData.includes('subscribe') || callbackData.includes('unsubscribe') || \n      callbackData.includes('time_settings') || callbackData.includes('notifications')) {\n    \n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: callbackData,\n        requestType: 'subscription_management',\n        chatId: chatId,\n        userName: userName,\n        subscriptionAction: callbackData,\n        callbackQueryId: input.json.callback_query.id\n      }\n    }];\n  }\n  \n  // –ê–¥–º–∏–Ω—Å–∫–∏–µ callback\n  if (callbackData.startsWith('admin_')) {\n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: callbackData,\n        requestType: 'admin_callback',\n        chatId: chatId,\n        adminAction: callbackData\n      }\n    }];\n  }\n  \n  // –û—Å—Ç–∞–ª—å–Ω—ã–µ callback\n  return [{\n    json: {\n      originalText: rawText,\n      normalizedText: callbackData,\n      requestType: 'callback_query',\n      chatId: chatId,\n      callbackData: callbackData,\n      callbackQueryId: input.json.callback_query.id\n    }\n  }];\n}\n\n// ========== –û–ë–†–ê–ë–û–¢–ö–ê –û–ë–´–ß–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô ==========\nrawText = (input?.json?.message?.text || '').trim();\nchatId = input?.json?.message?.chat?.id || 'unknown';\nuserName = input?.json?.message?.from?.first_name || 'User';\n\nif (!rawText) {\n  console.log('‚ùå No text in message');\n  return [{\n    json: {\n      originalText: '',\n      normalizedText: '',\n      requestType: 'empty_message',\n      chatId: chatId,\n      error: 'No text provided'\n    }\n  }];\n}\n\nconsole.log('üí¨ Raw input:', rawText);\nconsole.log('üë§ Chat ID:', chatId);\nconsole.log('üè∑Ô∏è User:', userName);\n\n// –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\nconst normalizedText = rawText.toLowerCase()\n  .replace(/[.,!?;:()\\\"]/g, ' ')\n  .replace(/\\s+/g, ' ')\n  .trim();\n\nconsole.log('üîÑ Normalized:', normalizedText);\n\n// ========== 2. –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ==========\nif (rawText.startsWith('/')) {\n  const command = rawText.split(' ')[0];\n  \n  switch (command) {\n    case '/start':\n      return [{\n        json: {\n          originalText: rawText,\n          normalizedText: normalizedText,\n          requestType: 'start_command',\n          chatId: chatId,\n          userName: userName\n        }\n      }];\n      \n    case '/help':\n      return [{\n        json: {\n          originalText: rawText,\n          normalizedText: normalizedText,\n          requestType: 'help_command',\n          chatId: chatId\n        }\n      }];\n      \n    case '/menu':\n      return [{\n        json: {\n          originalText: rawText,\n          normalizedText: normalizedText,\n          requestType: 'menu_command',\n          chatId: chatId\n        }\n      }];\n\n    case '/admin':\n    case '/stats':\n    case '/broadcast':\n    case '/users':\n    case '/music':\n    case '/export':\n    case '/dashboard':\n      return [{\n        json: {\n          originalText: rawText,\n          normalizedText: normalizedText,\n          requestType: 'admin_command',\n          chatId: chatId,\n          command: command\n        }\n      }];\n      \n    default:\n      return [{\n        json: {\n          originalText: rawText,\n          normalizedText: normalizedText,\n          requestType: 'unknown_command',\n          chatId: chatId,\n          command: command\n        }\n      }];\n  }\n}\n\n// ========== 1. –ü–†–ò–û–†–ò–¢–ï–¢: –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ü–û–î–ü–ò–°–ö–ò ==========\nconst confirmationPatterns = [\n  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏\n  { pattern: '–¥–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', type: 'confirm_subscribe' },\n  { pattern: '–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', type: 'confirm_subscribe' },\n  { pattern: '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –ø–æ–¥–ø–∏—Å–∫—É', type: 'confirm_subscribe' },\n  { pattern: '—Å–æ–≥–ª–∞—Å–µ–Ω –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', type: 'confirm_subscribe' },\n  \n  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–ø–∏—Å–∫–∏\n  { pattern: '–¥–∞ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è', type: 'confirm_unsubscribe' },\n  { pattern: '–¥–∞, –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è', type: 'confirm_unsubscribe' },\n  { pattern: '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –æ—Ç–ø–∏—Å–∫—É', type: 'confirm_unsubscribe' },\n  \n  // –ó–∞–ø—Ä–æ—Å—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n  { pattern: '—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ', type: 'request_details' },\n  { pattern: '–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ', type: 'request_details' },\n  { pattern: '—á—Ç–æ —ç—Ç–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫–∞', type: 'request_details' },\n  { pattern: '–∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç', type: 'request_details' },\n  \n  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏\n  { pattern: '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏', type: 'time_settings' },\n  { pattern: '–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è', type: 'time_settings' },\n  { pattern: '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏', type: 'music_settings' },\n  { pattern: '—Ç–æ–ª—å–∫–æ —É—Ç—Ä–æ–º', type: 'morning_only' },\n  { pattern: '—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º', type: 'evening_only' },\n  { pattern: '—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å', type: 'timezone_settings' },\n  \n  // –û—Ç–º–µ–Ω–∞/–ø–∞—É–∑–∞\n  { pattern: '–Ω–µ —Å–µ–π—á–∞—Å', type: 'cancel_action' },\n  { pattern: '–ø–µ—Ä–µ–¥—É–º–∞–ª', type: 'cancel_action' },\n  { pattern: '–ø–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é', type: 'pause_subscription' },\n  { pattern: '–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', type: 'modify_settings' },\n  \n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ\n  { pattern: '–ø—Ä–∏–º–µ—Ä—ã –º—É–∑—ã–∫–∏', type: 'music_examples' },\n  { pattern: '—É –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å', type: 'ask_question' },\n  { pattern: '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã', type: 'settings_complete' }\n];\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–í–´–°–®–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢!)\nfor (const { pattern, type } of confirmationPatterns) {\n  if (normalizedText.includes(pattern)) {\n    console.log('‚úÖ Subscription confirmation detected:', pattern, '‚Üí', type);\n    \n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: normalizedText,\n        requestType: 'subscription_confirmation',\n        chatId: chatId,\n        userName: userName,\n        confirmationType: type,\n        matchedPattern: pattern\n      }\n    }];\n  }\n}\n\n// ========== 3. –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–î–ü–ò–°–û–ö (–ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π!) ==========\nconst subscriptionKeywords = [\n  '–ø–æ–¥–ø–∏—Å', '—É–≤–µ–¥–æ–º–ª–µ–Ω', '—Ä–∞—Å—Å—ã–ª–∫', '–Ω–∞–ø–æ–º–∏–Ω–∞–Ω', '–ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',\n  '–æ—Ç–ø–∏—Å', '–æ—Ç–∫–ª—é—á —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', '–Ω–∞—Å—Ç—Ä–æ–π–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π'\n];\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\nlet isSubscriptionRequest = false;\nlet subscriptionKeyword = '';\n\nfor (const keyword of subscriptionKeywords) {\n  if (normalizedText.includes(keyword)) {\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —ç—Ç–æ –ù–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\n    const isNotConfirmation = !normalizedText.includes('–¥–∞') && \n                             !normalizedText.includes('–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é') &&\n                             !normalizedText.includes('—Å–æ–≥–ª–∞—Å–µ–Ω');\n    \n    if (isNotConfirmation) {\n      isSubscriptionRequest = true;\n      subscriptionKeyword = keyword;\n      break;\n    }\n  }\n}\n\nif (isSubscriptionRequest) {\n  console.log('üîî Subscription request detected:', subscriptionKeyword);\n  \n  return [{\n    json: {\n      originalText: rawText,\n      normalizedText: normalizedText,\n      requestType: 'subscription_inquiry',\n      chatId: chatId,\n      userName: userName,\n      keyword: subscriptionKeyword\n    }\n  }];\n}\n\n// ========== 4. –ú–£–ó–´–ö–ê–õ–¨–ù–´–ï –ó–ê–ü–†–û–°–´ ==========\nconst musicKeywords = [\n  '–º—É–∑—ã–∫–∞', '–ø–µ—Å–Ω—è', '–ø–ª–µ–π–ª–∏—Å—Ç', '–ø–æ—Å–ª—É—à–∞—Ç—å', '–∫–æ–º–ø–æ–∑–∏—Ü–∏—è', '—Ç—Ä–µ–∫',\n  'spotify', 'youtube', 'apple music', 'yandex music', '–≤–∫–ª—é—á–∏ –º—É–∑—ã–∫—É',\n  '–º—É–∑—ã–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è', '—á—Ç–æ –ø–æ—Å–ª—É—à–∞—Ç—å'\n];\n\nfor (const keyword of musicKeywords) {\n  if (normalizedText.includes(keyword)) {\n    console.log('üéµ Music request detected:', keyword);\n    \n    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–ª—è –º—É–∑—ã–∫–∏\n    let detectedMood = null;\n    const moodKeywords = {\n      '—Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∞—è': ['—Ä–∞—Å—Å–ª–∞–±', '—Ä–µ–ª–∞–∫—Å', '—Å–ø–æ–∫–æ–π', '–º–µ–¥–∏—Ç–∞—Ü'],\n      '—ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è': ['—ç–Ω–µ—Ä–≥', '–±–æ–¥—Ä', '–∞–∫—Ç–∏–≤–Ω', '–º–æ—Ç–∏–≤–∞—Ü', '—Å–ø–æ—Ä—Ç'],\n      '–¥–ª—è —Å–Ω–∞': ['—Å–æ–Ω', '–∑–∞—Å—ã–ø–∞–Ω', '–Ω–æ—á–Ω', '—É—Å—ã–ø–ª—è—é—â'],\n      '–¥–ª—è —Ä–∞–±–æ—Ç—ã': ['—Ä–∞–±–æ—Ç', '–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü', '—Ñ–æ–∫—É—Å', '—É—á–µ–±']\n    };\n    \n    for (const [mood, keywords] of Object.entries(moodKeywords)) {\n      for (const moodKeyword of keywords) {\n        if (normalizedText.includes(moodKeyword)) {\n          detectedMood = mood;\n          break;\n        }\n      }\n      if (detectedMood) break;\n    }\n    \n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: normalizedText,\n        requestType: 'music_request',\n        chatId: chatId,\n        userName: userName,\n        musicKeyword: keyword,\n        requestedMood: detectedMood,\n        timeOfDay: new Date().getHours() < 12 ? 'morning' : 'evening'\n      }\n    }];\n  }\n}\n\n// ========== 5. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ù–ê–°–¢–†–û–ï–ù–ò–Ø ==========\nconst moodKeywords = {\n  '—Å—Ç—Ä–µ—Å—Å': ['—Å—Ç—Ä–µ—Å—Å', '–Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ', '–Ω–µ—Ä–≤—ã', '—Ç—Ä–µ–≤–æ–≥', '–±–µ—Å–ø–æ–∫–æ–π', '–≤–æ–ª–Ω–µ–Ω'],\n  '—É—Å—Ç–∞–ª–æ—Å—Ç—å': ['—É—Å—Ç–∞–ª', '—É—Å—Ç–∞–ª–æ—Å—Ç—å', '—Å–∏–ª –Ω–µ—Ç', '–≤—ã–º–æ—Ç–∞–Ω', '–∏–∑–º–æ–∂–¥–µ–Ω', '—ç–Ω–µ—Ä–≥–∏–∏ –Ω–µ—Ç'],\n  '–≥—Ä—É—Å—Ç—å': ['–≥—Ä—É—Å—Ç–Ω', '–ø–µ—á–∞–ª—å', '—Ç–æ—Å–∫', '–¥–µ–ø—Ä–µ—Å—Å', '—É–Ω—ã–Ω–∏', '–ø–ª–æ—Ö–æ –Ω–∞ –¥—É—à–µ'],\n  '–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞': ['–Ω–µ —Å–ø–ª—é', '–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞', '–Ω–µ –∑–∞—Å—ã–ø–∞—é', '–ø–ª–æ—Ö–æ —Å–ø–ª—é', '–ø—Ä–æ—Å—ã–ø–∞—é—Å—å'],\n  '–≥–æ–ª–æ–≤–Ω–∞—è_–±–æ–ª—å': ['–±–æ–ª–∏—Ç –≥–æ–ª–æ–≤–∞', '–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å', '–º–∏–≥—Ä–µ–Ω—å', '–≥–æ–ª–æ–≤–∞ —Ä–∞—Å–∫–∞–ª—ã–≤–∞–µ—Ç—Å—è'],\n  '–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è': ['—Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è', '–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è', '–≤–Ω–∏–º–∞–Ω–∏–µ', '—Ñ–æ–∫—É—Å', '—Ä–∞–±–æ—Ç–∞'],\n  '—ç–Ω–µ—Ä–≥–∏—è': ['—ç–Ω–µ—Ä–≥–∏–∏', '–±–æ–¥—Ä–æ—Å—Ç—å', '–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', '—Å–∏–ª—ã', '–º–æ—Ç–∏–≤–∞—Ü–∏—è'],\n  '—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ': ['—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ', '—Ä–µ–ª–∞–∫—Å', '—Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ', '—É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ'],\n  '–ª—é–±–æ–≤—å': ['—Ä–æ–º–∞–Ω—Ç–∏–∫–∞', '–ª—é–±–æ–≤—å', '—Å–≤–∏–¥–∞–Ω–∏–µ', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Å—Ç—Ä–∞—Å—Ç—å'],\n  '—Ä–∞–¥–æ—Å—Ç—å': ['—Ä–∞–¥–æ—Å—Ç—å', '–≤–µ—Å–µ–ª—å–µ', '–ø–æ–∑–∏—Ç–∏–≤', '—Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', '—Å—á–∞—Å—Ç—å–µ']\n};\n\nlet detectedMood = null;\nlet moodScore = 0;\n\nfor (const [mood, keywords] of Object.entries(moodKeywords)) {\n  for (const keyword of keywords) {\n    if (normalizedText.includes(keyword)) {\n      const currentScore = keyword.length;\n      if (currentScore > moodScore) {\n        detectedMood = mood;\n        moodScore = currentScore;\n      }\n    }\n  }\n}\n\nif (detectedMood) {\n  console.log(`üòä Detected mood: ${detectedMood} (score: ${moodScore})`);\n  return [{\n    json: {\n      originalText: rawText,\n      normalizedText: normalizedText,\n      requestType: 'mood_request',\n      chatId: chatId,\n      detectedMood: detectedMood,\n      confidence: moodScore\n    }\n  }];\n}\n\n// ========== 6. –ü–û–ò–°–ö –ö–û–ù–ö–†–ï–¢–ù–´–• –ú–ê–°–ï–õ ==========\nconst oilSearchTerms = [\n  '–ª–∞–≤–∞–Ω–¥–∞', '—ç–≤–∫–∞–ª–∏–ø—Ç', '–º—è—Ç–∞', '–ª–∏–º–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '—Ä–æ–∑–∞', '–∂–∞—Å–º–∏–Ω',\n  '—á–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ', '—Ä–æ–∑–º–∞—Ä–∏–Ω', '–≥–µ—Ä–∞–Ω—å', '–±–µ—Ä–≥–∞–º–æ—Ç', '–∏–ª–∞–Ω–≥', '–ø–∞—á—É–ª–∏',\n  '—Å–∞–Ω–¥–∞–ª', '–∫–µ–¥—Ä', '—Å–æ—Å–Ω–∞', '–º–æ–∂–∂–µ–≤–µ–ª—å–Ω–∏–∫', '–ª–µ–º–æ–Ω–≥—Ä–∞—Å—Å', '–±–∞–∑–∏–ª–∏–∫',\n  '–æ—Ä–µ–≥–∞–Ω–æ', '—Ç–∏–º—å—è–Ω', '–º–µ–ª–∏—Å—Å–∞', '—Ä–æ–º–∞—à–∫–∞', '–∫–∞–ª–µ–Ω–¥—É–ª–∞', '—à–∞–ª—Ñ–µ–π',\n  '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–ª–∞–π–º', '–º–∞–Ω–¥–∞—Ä–∏–Ω', '–Ω–µ—Ä–æ–ª–∏', '–ø–µ—Ç–∏—Ç–≥—Ä–µ–π–Ω', '–≤–µ—Ç–∏–≤–µ—Ä'\n];\n\nlet foundOil = null;\nlet oilScore = 0;\n\nfor (const oil of oilSearchTerms) {\n  if (normalizedText.includes(oil)) {\n    const currentScore = oil.length;\n    if (currentScore > oilScore) {\n      foundOil = oil;\n      oilScore = currentScore;\n    }\n  }\n}\n\nif (foundOil) {\n  console.log(`üåø Found oil: ${foundOil} (score: ${oilScore})`);\n  return [{\n    json: {\n      originalText: rawText,\n      normalizedText: normalizedText,\n      requestType: 'direct_search',\n      chatId: chatId,\n      oilName: foundOil,\n      normalizedOilName: foundOil,\n      confidence: oilScore\n    }\n  }];\n}\n\n// ========== 7. –ö–ê–¢–ï–ì–û–†–ò–ò –ú–ê–°–ï–õ ==========\nconst categoryKeywords = {\n  '—Ü–∏—Ç—Ä—É—Å–æ–≤—ã–µ': ['—Ü–∏—Ç—Ä—É—Å', '–ª–∏–º–æ–Ω', '–∞–ø–µ–ª—å—Å–∏–Ω', '–≥—Ä–µ–π–ø—Ñ—Ä—É—Ç', '–º–∞–Ω–¥–∞—Ä–∏–Ω', '–ª–∞–π–º'],\n  '—Ü–≤–µ—Ç–æ—á–Ω—ã–µ': ['—Ü–≤–µ—Ç–æ—á–Ω', '—Ä–æ–∑–∞', '–∂–∞—Å–º–∏–Ω', '–≥–µ—Ä–∞–Ω—å', '–ª–∞–≤–∞–Ω–¥–∞', '—Ä–æ–º–∞—à–∫–∞'],\n  '–¥—Ä–µ–≤–µ—Å–Ω—ã–µ': ['–¥—Ä–µ–≤–µ—Å–Ω', '—Å–∞–Ω–¥–∞–ª', '–∫–µ–¥—Ä', '—Å–æ—Å–Ω–∞', '–º–æ–∂–∂–µ–≤–µ–ª—å–Ω–∏–∫'],\n  '—Ç—Ä–∞–≤—è–Ω—ã–µ': ['—Ç—Ä–∞–≤—è–Ω', '–±–∞–∑–∏–ª–∏–∫', '—Ä–æ–∑–º–∞—Ä–∏–Ω', '—Ç–∏–º—å—è–Ω', '—à–∞–ª—Ñ–µ–π', '–º—è—Ç–∞'],\n  '—Å–º–æ–ª–∏—Å—Ç—ã–µ': ['—Å–º–æ–ª–∏—Å—Ç', '–ª–∞–¥–∞–Ω', '–º–∏—Ä—Ä–∞', '–∫–æ–ø–∞–ª'],\n  '–ø—Ä—è–Ω—ã–µ': ['–ø—Ä—è–Ω', '–∫–æ—Ä–∏—Ü–∞', '–≥–≤–æ–∑–¥–∏–∫–∞', '–∏–º–±–∏—Ä—å', '–∫–∞—Ä–¥–∞–º–æ–Ω']\n};\n\nlet detectedCategory = null;\nlet categoryScore = 0;\n\nfor (const [category, keywords] of Object.entries(categoryKeywords)) {\n  for (const keyword of keywords) {\n    if (normalizedText.includes(keyword)) {\n      const currentScore = keyword.length;\n      if (currentScore > categoryScore) {\n        detectedCategory = category;\n        categoryScore = currentScore;\n      }\n    }\n  }\n}\n\nif (detectedCategory) {\n  console.log(`üìÇ Detected category: ${detectedCategory} (score: ${categoryScore})`);\n  return [{\n    json: {\n      originalText: rawText,\n      normalizedText: normalizedText,\n      requestType: 'category_request',\n      chatId: chatId,\n      requestedCategory: detectedCategory,\n      confidence: categoryScore\n    }\n  }];\n}\n\n// ========== 8. –û–ë–©–ò–ï –í–û–ü–†–û–°–´ –û–ë –ê–†–û–ú–ê–¢–ï–†–ê–ü–ò–ò ==========\nconst generalKeywords = [\n  '—á—Ç–æ —Ç–∞–∫–æ–µ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è', '–∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å', '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è',\n  '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞', '–∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å', '–ø–æ–ª—å–∑–∞ –º–∞—Å–µ–ª', '—Å–≤–æ–π—Å—Ç–≤–∞ –º–∞—Å–µ–ª',\n  '–¥–∏—Ñ—Ñ—É–∑–æ—Ä', '–º–∞—Å—Å–∞–∂', '–∏–Ω–≥–∞–ª—è—Ü–∏—è', '–∫–æ–º–ø—Ä–µ—Å—Å'\n];\n\nfor (const keyword of generalKeywords) {\n  if (normalizedText.includes(keyword)) {\n    console.log(`‚ÑπÔ∏è General aromatherapy question: ${keyword}`);\n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: normalizedText,\n        requestType: 'general_aromatherapy',\n        chatId: chatId,\n        keyword: keyword\n      }\n    }];\n  }\n}\n\n// ========== 9. –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø –ò –ë–õ–ê–ì–û–î–ê–†–ù–û–°–¢–ò ==========\nconst greetingKeywords = [\n  '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '–¥–æ–±—Ä', '—Å–ø–∞—Å–∏–±–æ', '–±–ª–∞–≥–æ–¥–∞—Ä'\n];\n\nfor (const greeting of greetingKeywords) {\n  if (normalizedText.includes(greeting)) {\n    console.log(`üëã Greeting detected: ${greeting}`);\n    return [{\n      json: {\n        originalText: rawText,\n        normalizedText: normalizedText,\n        requestType: 'greeting',\n        chatId: chatId,\n        greetingType: greeting\n      }\n    }];\n  }\n}\n\n// ========== 10. FALLBACK - –ù–ï–û–ü–û–ó–ù–ê–ù–ù–´–ô –ó–ê–ü–†–û–° ==========\nconsole.log('‚ùì Unknown request type');\nreturn [{\n  json: {\n    originalText: rawText,\n    normalizedText: normalizedText,\n    requestType: 'unknown',\n    chatId: chatId,\n    needsHumanAnalysis: true,\n    userActivity: {\n      chatId: chatId,\n      userName: userName,\n      timestamp: new Date().toISOString(),\n      messageType: 'text'\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        -144
      ],
      "id": "f0d94d86-3c1d-406f-8c90-081c4bf34a77",
      "name": "Smart Router"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "oils",
        "filters": {
          "conditions": [
            {
              "keyName": "oil_name",
              "condition": "ilike",
              "keyValue": "=%{{ $json.normalizedOilName }}%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1728,
        -240
      ],
      "id": "3eb8566d-9f2a-4420-bc08-11e1578bc9d8",
      "name": "Supabase2",
      "credentials": {
        "supabaseApi": {
          "id": "jyysiKb0eSXuvPiH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7afe1d6e-1a7d-4c4b-8062-1ac9bcdcffbc",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "keyword_search",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1792,
        -16
      ],
      "id": "a041fede-6c8d-4250-a790-55f273d65c40",
      "name": "keyword_search",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "oils"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2064,
        -80
      ],
      "id": "5410e8a0-f941-4c88-a52d-c1d0d5028076",
      "name": "Get All Oils for AI",
      "credentials": {
        "supabaseApi": {
          "id": "jyysiKb0eSXuvPiH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "df38d20b-d97c-4b94-9cb3-f09d203972fa",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "start_command",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1280,
        -144
      ],
      "id": "1b92bae9-38aa-46b7-8930-8d3030a4fcd1",
      "name": "IF Start Command",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "chatId": "={{ $('Smart Router').first().json.chatId }}",
        "text": "={{ $('Smart Router').item.json.originalText }}\n        üåø **–ê–†–û–ú–ê-–ü–û–ú–û–©–ù–ò–ö** üåø\n\n‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä —ç—Ñ–∏—Ä–Ω—ã—Ö –º–∞—Å–µ–ª! ‚ú®\n\n–Ø —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥ –ø–æ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏ üßô‚Äç‚ôÇÔ∏è\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüí¨ **–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Å–ª–∞** (–º—è—Ç–∞, –ª–∞–≤–∞–Ω–¥–∞, –ª–∏–º–æ–Ω...)\nüéØ **–ò–ª–∏ –≤—ã–±–µ—Ä–∏ –±—ã—Å—Ç—Ä—É—é –ø–æ–º–æ—â—å:**\nüîÆ **–í–Ω–∏–º–∞–Ω–∏–µ:** –ö–Ω–æ–ø–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç –¥—Ä–µ–≤–Ω–∏–π —Ä–∏—Ç—É–∞–ª –ø–æ–∏—Å–∫–∞ –∑–Ω–∞–Ω–∏–π!\nüßô‚Äç‚ôÇÔ∏è –ü—Ä–∏–∑—ã–≤–∞—é –¥—É—Ö–æ–≤ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏ –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é—Å—å —Å –º—É–¥—Ä–µ—Ü–∞–º–∏...\n‚è≥ –ú–∞–≥–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ - –æ–∫–æ–ª–æ 40 —Å–µ–∫—É–Ω–¥! ‚ú®",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚ö° –≠–ù–ï–†–ì–ò–Ø & –ë–û–î–†–û–°–¢–¨",
                    "additionalFields": {
                      "callback_data": "need_energy"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üßò‚Äç‚ôÄÔ∏è –†–ï–õ–ê–ö–° & –°–û–ù",
                    "additionalFields": {
                      "callback_data": "want_relax"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè• –ó–î–û–†–û–í–¨–ï",
                    "additionalFields": {
                      "callback_data": "health_issues"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üí° –ü–û–ú–û–©–¨",
                    "additionalFields": {
                      "callback_data": "help_menu"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–ó–∞–ø–∏—Å—å –Ω–∞ –ê—Ä–æ–º–∞–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É",
                    "additionalFields": {
                      "callback_data": "program_21"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1472,
        -336
      ],
      "id": "f62f9ab9-87c7-4516-93c3-1f146abb835b",
      "name": "Start Response",
      "webhookId": "1b20dc7c-288b-41b6-82bd-c68946ce2219",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2944,
        64
      ],
      "id": "df0c50ba-fe06-447f-b6ec-5560158a070e",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "pLvgZqZjmESpZh3A",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Smart Router').first().json.chatId }}",
        "text": "={{ $json.output }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3424,
        -176
      ],
      "id": "4ea8c9d8-6526-44fc-9a4e-88f8e3f92518",
      "name": "Telegram AI Response",
      "webhookId": "c8146fb9-f142-4594-9a95-1fd443da1ef3",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π AI Agent –∫–æ–¥ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π\nconst userRequest = $('Smart Router').first().json;\nconst oilsData = $('Get All Oils for AI').all();\n\nconsole.log('ü§ñ AI Agent –∫–æ–¥: –ø–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ');\nconsole.log('üìã User request:', JSON.stringify(userRequest, null, 2));\nconsole.log('üíä Medical info –Ω–∞–π–¥–µ–Ω–∞:', userRequest.medicalInfo ? '–î–ê' : '–ù–ï–¢');\nconsole.log('üè• –ö–∞—Ç–µ–≥–æ—Ä–∏—è:', userRequest.medicalInfo?.category);\nconsole.log('üéØ Request type:', userRequest.requestType);\n\n// –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ\nconst keywords = userRequest.keywords || [];\nconst userQuery = userRequest.userQuery || userRequest.originalText || '–ø–æ–º–æ—â—å';\nconst medicalInfo = userRequest.medicalInfo || null;\n\nconsole.log('Keywords:', keywords);\nconsole.log('User query:', userQuery);\nconsole.log('Medical info:', medicalInfo);\n\n// üÜï –õ–û–ì–ò–ö–ê –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –¢–ò–ü–ê –ê–ì–ï–ù–¢–ê\nlet needsPerplexitySearch = false;\nlet requestContext = '';\nlet searchQueries = [];\nlet specialInstructions = '';\n\n// ============================================\n// üî• –ö–õ–Æ–ß–ï–í–ê–Ø –õ–û–ì–ò–ö–ê –í–´–ë–û–†–ê –ê–ì–ï–ù–¢–ê\n// ============================================\n\n// 1. –ö–ù–û–ü–û–ß–ù–´–ï –ó–ê–ü–†–û–°–´ ‚Üí AI Agent. Fast (–ë–ï–ó Perplexity)\nif (userRequest.isCallbackQuery && \n    (userRequest.originalText === '–Ω—É–∂–Ω–∞ —ç–Ω–µ—Ä–≥–∏—è' || \n     userRequest.originalText === '—Ö–æ—á—É —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è' || \n     userRequest.originalText === '–ø—Ä–æ—Å—Ç—É–¥–∞')) {\n  \n  console.log('üîò –ö–ù–û–ü–û–ß–ù–´–ô –ó–ê–ü–†–û–° ‚Üí AI Agent. Fast');\n  needsPerplexitySearch = false;\n  \n  if (keywords.includes('—ç–Ω–µ—Ä–≥–∏—è')) {\n    requestContext = '–≠–ù–ï–†–ì–ò–Ø –ò –ë–û–î–†–û–°–¢–¨';\n  } else if (keywords.includes('—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ')) {\n    requestContext = '–†–ê–°–°–õ–ê–ë–õ–ï–ù–ò–ï –ò –ü–û–ö–û–ô';\n  } else if (keywords.includes('–ø—Ä–æ—Å—Ç—É–¥–∞')) {\n    requestContext = '–ó–î–û–†–û–í–¨–ï –ò –õ–ï–ß–ï–ù–ò–ï';\n  } else {\n    requestContext = '–û–ë–©–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò';\n  }\n}\n\n// 2. –°–õ–û–ñ–ù–´–ï –ú–ï–î–ò–¶–ò–ù–°–ö–ò–ï –ó–ê–ü–†–û–°–´ ‚Üí AI Agent Perplexity) (–° Perplexity)\nelse if (medicalInfo && medicalInfo.category) {\n  console.log('üè• –ú–ï–î–ò–¶–ò–ù–°–ö–ò–ô –ó–ê–ü–†–û–° ‚Üí AI Agent Perplexity)');\n  needsPerplexitySearch = true;\n  \n  switch(medicalInfo.category) {\n    case '–≥–æ–ª–æ–≤–Ω–∞—è_–±–æ–ª—å':\n      requestContext = '–ì–û–õ–û–í–ù–ê–Ø –ë–û–õ–¨ –ò –ú–ò–ì–†–ï–ù–¨';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –º–∏–≥—Ä–µ–Ω—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è 2024',\n        '–ª–∞–≤–∞–Ω–¥–∞ –º—è—Ç–∞ –ø–µ—Ä–µ—á–Ω–∞—è –æ—Ç –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –º–∏–≥—Ä–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞—É—á–Ω—ã–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞'\n      ];\n      specialInstructions = '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–≥—Ä–µ–Ω–∏, –¥–æ–∑–∏—Ä–æ–≤–∫–∏, —Å–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤—Ä–∞—á–∞ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –≥–æ–ª–æ–≤–Ω—ã—Ö –±–æ–ª—è—Ö.';\n      break;\n\n    case '–∂–µ–ª—É–¥–æ—á–Ω–æ_–∫–∏—à–µ—á–Ω—ã–µ':\n      requestContext = '–ü–ò–©–ï–í–ê–†–ï–ù–ò–ï –ò –ñ–ö–¢';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ –∂–µ–ª—É–¥–æ–∫ –Ω–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',\n        '–º—è—Ç–∞ –∏–º–±–∏—Ä—å —Ñ–µ–Ω—Ö–µ–ª—å –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è',\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø—Ä–∏ —Ç–æ—à–Ω–æ—Ç–µ –∏–∑–∂–æ–≥–µ —Å–ø–∞–∑–º–∞—Ö –ñ–ö–¢'\n      ];\n      specialInstructions = '–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –≤–∞–∂–Ω–æ—Å—Ç—å –∫–∞—á–µ—Å—Ç–≤–∞ –º–∞—Å–µ–ª –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è. –î–∞—Ç—å —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—é –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–µ.';\n      break;\n\n    case '–∂–µ–Ω—Å–∫–æ–µ_–∑–¥–æ—Ä–æ–≤—å–µ':\n      requestContext = '–ñ–ï–ù–°–ö–û–ï –ó–î–û–†–û–í–¨–ï –ò –ü–ú–°';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ü–ú–° –∂–µ–Ω—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å',\n        '—à–∞–ª—Ñ–µ–π –º—É—Å–∫–∞—Ç–Ω—ã–π –≥–µ—Ä–∞–Ω—å –∂–µ–Ω—Å–∫–∏–µ —Ü–∏–∫–ª—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω—ã–µ –±–æ–ª–∏ —Å–ø–∞–∑–º—ã –Ω–∞—É—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'\n      ];\n      specialInstructions = '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ, –æ–±–ª–µ–≥—á–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.';\n      break;\n\n    case '–¥—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è_—Å–∏—Å—Ç–µ–º–∞':\n      requestContext = '–î–´–•–ê–¢–ï–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ò –ü–†–û–°–¢–£–î–ê';\n      searchQueries = [\n        '—ç–≤–∫–∞–ª–∏–ø—Ç —á–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø—Ä–æ—Å—Ç—É–¥–∞ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏',\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –ø—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä–Ω—ã–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –∫–∞—à–µ–ª—å –Ω–∞—Å–º–æ—Ä–∫ –∑–∞–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –Ω–æ—Å–∞'\n      ];\n      specialInstructions = '–§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–≤–∏—Ä—É—Å–Ω—ã—Ö –∏ –æ—Ç—Ö–∞—Ä–∫–∏–≤–∞—é—â–∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö. –ú–µ—Ç–æ–¥—ã –∏–Ω–≥–∞–ª—è—Ü–∏–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ—Å–ø–∏—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö.';\n      break;\n\n    case '–Ω–µ—Ä–≤–Ω–∞—è_—Å–∏—Å—Ç–µ–º–∞':\n      requestContext = '–ù–ï–†–í–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ò –°–¢–†–ï–°–°';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ —Å—Ç—Ä–µ—Å—Å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å –∫–æ—Ä—Ç–∏–∑–æ–ª –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',\n        '–ª–∞–≤–∞–Ω–¥–∞ –±–µ—Ä–≥–∞–º–æ—Ç —Ä–æ–º–∞—à–∫–∞ –Ω–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—É—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –¥–µ–ø—Ä–µ—Å—Å–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'\n      ];\n      specialInstructions = '–£–ø–æ—Ä –Ω–∞ –Ω–µ–π—Ä–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∞—Ä–æ–º–∞—Ç–æ–≤, –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –ª–∏–º–±–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É, –º–µ—Ç–æ–¥—ã —Å–Ω–∏–∂–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–∞.';\n      break;\n\n    case '—Å–æ–Ω_–∏_–æ—Ç–¥—ã—Ö':\n      requestContext = '–°–û–ù –ò –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï';\n      searchQueries = [\n        '–ª–∞–≤–∞–Ω–¥–∞ –º–µ–ª–∏—Å—Å–∞ —Å–æ–Ω –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –º–µ–ª–∞—Ç–æ–Ω–∏–Ω –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ —Ü–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —Å–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—É—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'\n      ];\n      specialInstructions = '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –º–µ–ª–∞—Ç–æ–Ω–∏–Ω, —Ü–∏—Ä–∫–∞–¥–Ω—ã–µ —Ä–∏—Ç–º—ã, —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∏—Ç—É–∞–ª–æ–≤ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º.';\n      break;\n\n    case '–º—ã—à—Ü—ã_–∏_—Å—É—Å—Ç–∞–≤—ã':\n      requestContext = '–ú–´–®–¶–´, –°–£–°–¢–ê–í–´ –ò –ë–û–õ–¨';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –º—ã—à–µ—á–Ω–∞—è –±–æ–ª—å –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ —Å—É—Å—Ç–∞–≤—ã',\n        '–≤–∏–Ω—Ç–µ—Ä–≥—Ä–∏–Ω —ç–≤–∫–∞–ª–∏–ø—Ç –ø—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –º–∞—Å–µ–ª',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –∞—Ä—Ç—Ä–∏—Ç —Ä–µ–≤–º–∞—Ç–∏–∑–º –º—ã—à–µ—á–Ω—ã–µ —Å–ø–∞–∑–º—ã'\n      ];\n      specialInstructions = '–§–æ–∫—É—Å –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö, –º–µ—Ç–æ–¥–∞—Ö –º–∞—Å—Å–∞–∂–∞, —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–∏ –¥–ª—è —Ç–æ–ø–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è.';\n      break;\n\n    case '–∫–æ–∂–Ω—ã–µ_–ø—Ä–æ–±–ª–µ–º—ã':\n      requestContext = '–ó–î–û–†–û–í–¨–ï –ö–û–ñ–ò';\n      searchQueries = [\n        '—á–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ª–∞–≤–∞–Ω–¥–∞ –∫–æ–∂–∞ –∞–∫–Ω–µ –¥–µ—Ä–º–∞—Ç–∏—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –∞–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∫–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è —ç–∫–∑–µ–º–∞ –ø—Å–æ—Ä–∏–∞–∑ –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è –∫–æ–∂–∏'\n      ];\n      specialInstructions = '–í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –∫–æ–∂–∏, —Ç–µ—Å—Ç –Ω–∞ –∞–ª–ª–µ—Ä–≥–∏—é, –∞–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–µ –∏ –∑–∞–∂–∏–≤–ª—è—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞.';\n      break;\n\n    case '–∏–º–º—É–Ω–∏—Ç–µ—Ç':\n      requestContext = '–ò–ú–ú–£–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç –∑–∞—â–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞',\n        '—á–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —ç–≤–∫–∞–ª–∏–ø—Ç –∏–º–º—É–Ω–æ–º–æ–¥—É–ª–∏—Ä—É—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞'\n      ];\n      specialInstructions = '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ, —É–∫—Ä–µ–ø–ª–µ–Ω–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞—â–∏—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –æ—Ä–≥–∞–Ω–∏–∑–º–∞.';\n      break;\n\n    default:\n      requestContext = '–û–ë–©–ò–ï –ú–ï–î–ò–¶–ò–ù–°–ö–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò';\n      searchQueries = [\n        '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –∑–¥–æ—Ä–æ–≤—å–µ –Ω–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è 2024',\n        '–∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è —Ö–æ–ª–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω–∞'\n      ];\n  }\n}\n\n// 3. –û–ë–´–ß–ù–´–ï –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê ‚Üí AI Agent. Fast (–ë–ï–ó Perplexity)\nelse if (Array.isArray(keywords) && keywords.length > 0) {\n  console.log('üè∑Ô∏è –û–ë–´–ß–ù–´–ï –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê ‚Üí AI Agent. Fast');\n  needsPerplexitySearch = false;\n  \n  if (keywords.includes('—ç–Ω–µ—Ä–≥–∏—è')) {\n    requestContext = '–≠–ù–ï–†–ì–ò–Ø –ò –ë–û–î–†–û–°–¢–¨';\n  } else if (keywords.includes('—Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ')) {\n    requestContext = '–†–ê–°–°–õ–ê–ë–õ–ï–ù–ò–ï –ò –ü–û–ö–û–ô';\n  } else if (keywords.includes('–ø—Ä–æ—Å—Ç—É–¥–∞')) {\n    requestContext = '–ó–î–û–†–û–í–¨–ï –ò –õ–ï–ß–ï–ù–ò–ï';\n  } else {\n    requestContext = '–û–ë–©–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò';\n  }\n}\n\n// 4. –î–ï–§–û–õ–¢ ‚Üí AI Agent. Fast\nelse {\n  console.log('üîÑ –î–ï–§–û–õ–¢ ‚Üí AI Agent. Fast');\n  needsPerplexitySearch = false;\n  requestContext = '–û–ë–©–ò–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò';\n}\n\n// –í—ã–±–∏—Ä–∞–µ–º –≥–ª–∞–≤–Ω—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å\nconst mainSearchQuery = searchQueries[0] || '—ç—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è';\n\nconsole.log('ü§ñ –í–´–ë–†–ê–ù –ê–ì–ï–ù–¢:', needsPerplexitySearch ? 'AI Agent Perplexity)' : 'AI Agent. Fast');\nconsole.log('Request context:', requestContext);\nconsole.log('Search queries prepared:', searchQueries.length);\nconsole.log('Special instructions:', specialInstructions);\n\n// –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤\nconst keywordsString = Array.isArray(keywords) ? keywords.join(', ') : '–Ω–µ—Ç';\n\n// –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ AI Agent\nreturn [{\n  json: {\n    chatId: userRequest.chatId,\n    requestType: userRequest.requestType,\n    context: requestContext,\n    userQuery: userQuery,\n    keywords: keywords,\n    keywordsString: keywordsString,\n    \n    // üî• –ö–õ–Æ–ß–ï–í–û–ï –ü–û–õ–ï –î–õ–Ø –í–´–ë–û–†–ê –ê–ì–ï–ù–¢–ê\n    needsPerplexitySearch: needsPerplexitySearch,\n    \n    // –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ\n    medicalInfo: medicalInfo,\n    specialInstructions: specialInstructions,\n    enhancedPrompt: needsPerplexitySearch ? 'enhanced medical prompt' : 'fast simple prompt',\n    \n    // –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–µ–±-–ø–æ–∏—Å–∫–∞\n    mainSearchQuery: mainSearchQuery,\n    allSearchQueries: searchQueries,\n    searchEnabled: needsPerplexitySearch,\n    \n    // –î–∞–Ω–Ω—ã–µ –æ –º–∞—Å–ª–∞—Ö –∏–∑ –±–∞–∑—ã\n    oilsCount: oilsData.length,\n    oilsData: oilsData.slice(0, 20), // –¢–æ–ø-20 –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤\n    \n    // –î–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞\n    isAIRecommendation: true, \n    isMedicalQuery: medicalInfo ? true : false,\n    callbackQueryId: userRequest.callbackQueryId || null,\n    \n    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n    debug: {\n      agentType: needsPerplexitySearch ? 'Perplexity' : 'Fast',\n      isCallback: userRequest.isCallbackQuery || false,\n      hasMedicalInfo: medicalInfo ? true : false,\n      keywordsCount: keywords.length\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2288,
        -80
      ],
      "id": "16b184b4-c550-4ec1-9ebb-53d594f52786",
      "name": "AI Agent –∫–æ–¥"
    },
    {
      "parameters": {
        "messages": {
          "message": [
            {
              "content": "={{ $json.mainSearchQuery }}"
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexityTool",
      "typeVersion": 1,
      "position": [
        3152,
        -464
      ],
      "id": "6afdbd35-2914-4fb3-a58e-23498ee388d6",
      "name": "Perplexity",
      "credentials": {
        "perplexityApi": {
          "id": "W2yAuOlhzNtJI50T",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "537551b8-ea62-4e2e-92f6-b0c7b37b312a",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "disambiguation",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        224,
        -1504
      ],
      "id": "2098d5fa-eb93-4353-ade5-cee5eb004e00",
      "name": "IF Disambiguation"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6611f9f7-fa85-4229-b4d0-f54fad14eb1f",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "oil_comparison",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "1ab7de4e-a161-4430-9c58-bbbe7aa17452",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "disambiguation",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        960,
        160
      ],
      "id": "216e995b-3dbf-4bd2-b60e-05fb3be72e26",
      "name": "IF Oil Comparison"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "123",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–∞—Å–µ–ª",
                    "additionalFields": {
                      "callback_data": "compare_oils"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1264,
        112
      ],
      "id": "c8007ea6-3c03-445e-838b-0b0a7aa23f22",
      "name": "Oil Comparison Response",
      "webhookId": "b5f8c588-814e-403f-9b7e-e2818ab4781b",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ú—è—Ç–∞ –ø–µ—Ä–µ—á–Ω–∞—è",
                    "additionalFields": {
                      "callback_data": "select_oil:–ú—è—Ç–∞ –ø–µ—Ä–µ—á–Ω–∞—è"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –ú—è—Ç–∞ —Å–∞–¥–æ–≤–∞—è",
                    "additionalFields": {
                      "callback_data": "select_oil:–ú—è—Ç–∞ —Å–∞–¥–æ–≤–∞—è"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -2320
      ],
      "id": "a2d02fa5-0cd1-472e-8f21-e63679e5a59f",
      "name": "Disambiguation Mint (–¥–ª—è –º—è—Ç—ã)",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ß—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü",
                    "additionalFields": {
                      "callback_data": "select_oil:–ß—ë—Ä–Ω—ã–π –ø–µ—Ä–µ—Ü"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –†–æ–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ü",
                    "additionalFields": {
                      "callback_data": "select_oil:–†–æ–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ü"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -2128
      ],
      "id": "bebf0d4d-f76c-4952-bae1-4002173f97a7",
      "name": "Disambiguation Pepper (–¥–ª—è –ø–µ—Ä—Ü–∞)",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –®–∞–ª—Ñ–µ–π –º—É—Å–∫–∞—Ç–Ω—ã–π",
                    "additionalFields": {
                      "callback_data": "select_oil:–®–∞–ª—Ñ–µ–π –º—É—Å–∫–∞—Ç–Ω—ã–π"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –®–∞–ª—Ñ–µ–π –∏—Å–ø–∞–Ω—Å–∫–∏–π",
                    "additionalFields": {
                      "callback_data": "select_oil:–®–∞–ª—Ñ–µ–π –∏—Å–ø–∞–Ω—Å–∫–∏–π"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1936
      ],
      "id": "b5f4d1e5-3c8b-4c85-aa24-1d65085ddd96",
      "name": "Disambiguation Sage (–¥–ª—è —à–∞–ª—Ñ–µ—è)",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –≠–≤–∫–∞–ª–∏–ø—Ç",
                    "additionalFields": {
                      "callback_data": "select_oil:–≠–≤–∫–∞–ª–∏–ø—Ç"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –õ–∏–º–æ–Ω–Ω—ã–π —ç–≤–∫–∞–ª–∏–ø—Ç",
                    "additionalFields": {
                      "callback_data": "select_oil:–õ–∏–º–æ–Ω–Ω—ã–π —ç–≤–∫–∞–ª–∏–ø—Ç"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1760
      ],
      "id": "69654d22-ab49-40db-9bed-86d0e0c6b3df",
      "name": "Disambiguation Eucalyptus (–¥–ª—è —ç–≤–∫–∞–ª–∏–ø—Ç–∞)",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nconst ambiguousKey = data.ambiguousKey;\nconst options = data.options || [];\n\nconsole.log('üîÑ Disambiguation Router started');\nconsole.log('Ambiguous key:', ambiguousKey);\nconsole.log('Options:', options);\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π Telegram —É–∑–µ–ª –≤—ã–∑–≤–∞—Ç—å\nlet targetNode = '';\n\nswitch(ambiguousKey) {\n  case '–º—è—Ç–∞':\n    targetNode = 'mint';\n    break;\n  case '–ø–µ—Ä–µ—Ü':\n    targetNode = 'pepper';\n    break;\n  case '—à–∞–ª—Ñ–µ–π':\n    targetNode = 'sage';\n    break;\n  case '—ç–≤–∫–∞–ª–∏–ø—Ç':\n    targetNode = 'eucalyptus';\n    break;\n  case '–ø–∏—Ö—Ç–∞':\n    targetNode = 'pine';\n    break;\n  case '–º–∞–Ω–¥–∞—Ä–∏–Ω':\n    targetNode = 'mandarin';\n    break;\n  case '–±–∞–∑–∏–ª–∏–∫':\n    targetNode = 'basil';\n    break;\n  case '—Å–∏—Ç—Ä—É—Å':\n    targetNode = 'citrus';\n    break;\n  case '—Ö–æ–ª–∏–¥–µ–π':\n    targetNode = 'holiday';\n    break;\n  case '—á–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ':\n    targetNode = 'tea_tree';\n    break;\n  // üÜï –ù–û–í–´–ï –ù–ï–û–î–ù–û–ó–ù–ê–ß–ù–û–°–¢–ò\n  case '–¥–µ—Ä–µ–≤–æ':\n    targetNode = 'tree';\n    break;\n  case '—Ä–æ–º–∞—à–∫–∞':\n    targetNode = 'chamomile';\n    break;\n  case '–µ–ª—å':\n    targetNode = 'spruce';\n    break;\n  case '–ª–∏–º–æ–Ω':\n    targetNode = 'lemon';\n    break;\n  case '–∞–ø–µ–ª—å—Å–∏–Ω':\n    targetNode = 'orange';\n    break;\n  default:\n    targetNode = 'universal'; // —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\n}\n\nconsole.log('üéØ Target node determined:', targetNode, 'for key:', ambiguousKey);\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤\nconst buttons = [];\n\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞\noptions.forEach((option, index) => {\n  const isDefault = option === data.defaultChoice;\n  const emoji = isDefault ? 'üåü' : 'üåø';\n  \n  buttons.push({\n    row: {\n      buttons: [{\n        text: `${emoji} ${option}`,\n        additionalFields: {\n          callback_data: `select_oil:${option}`\n        }\n      }]\n    }\n  });\n});\n\n// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É \"–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\"\nbuttons.push({\n  row: {\n    buttons: [{\n      text: \"üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\",\n      additionalFields: {\n        callback_data: \"main_menu\"\n      }\n    }]\n  }\n});\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è\nlet messageText = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${data.originalQuery}\":\\n\\n`;\nmessageText += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${data.defaultChoice}**\\n`;\nmessageText += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\nmessageText += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n\noptions.forEach((option, index) => {\n  const isDefault = option === data.defaultChoice;\n  const emoji = isDefault ? 'üåü' : 'üåø';\n  messageText += `${emoji} ${option}\\n`;\n});\n\nmessageText += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ü–µ–ª–µ–≤–æ–≥–æ —É–∑–ª–∞\nreturn [{\n  json: {\n    ...data,\n    targetNode: targetNode,\n    \n    // –î–∞–Ω–Ω—ã–µ –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ —Ç–µ–ª–µ–≥—Ä–∞–º —É–∑–ª–∞\n    messageText: messageText,\n    dynamicButtons: buttons,\n    \n    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è\n    debug: {\n      ambiguousKey: ambiguousKey,\n      optionsCount: options.length,\n      targetNode: targetNode,\n      hasValidOptions: options.length >= 2,\n      allOptions: options\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        -1696
      ],
      "id": "0222bac6-9e50-4848-a7b4-43e423094013",
      "name": "Disambiguation Router"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c67a1aa1-6801-4680-b4ec-4d7ba0acd899",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "mint",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        -2240
      ],
      "id": "8d9d4413-4ef2-4e00-ad98-13b1830939b7",
      "name": "IF Mint"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "6e5f9395-89b4-4f7c-8c10-996771c00253",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "pepper",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        -2064
      ],
      "id": "2e7cf268-7b24-40e0-8cbf-0427947c28ca",
      "name": "IF Pepper"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f0ef6f06-5aeb-4b6b-aa44-30203ef90326",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "sage",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        -1888
      ],
      "id": "fb9b0160-3e7f-4fb9-bd83-abc025ae233c",
      "name": "IF Sage"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "eucalyptus",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        -1744
      ],
      "id": "8ca2a6cf-b720-4189-aae5-b383519ac33e",
      "name": "IF Eucalyptus"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "pine",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        528,
        -1584
      ],
      "id": "7d0c1a9e-8b0d-4835-81b2-b650a9831782",
      "name": "IF Pixta"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ü–∏—Ö—Ç–∞ —Å–∏–±–∏—Ä—Å–∫–∞—è",
                    "additionalFields": {
                      "callback_data": "select_oil:–ü–∏—Ö—Ç–∞ —Å–∏–±–∏—Ä—Å–∫–∞—è"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –ü–∏—Ö—Ç–∞ –î—É–≥–ª–∞—Å–∞",
                    "additionalFields": {
                      "callback_data": "select_oil:–ü–∏—Ö—Ç–∞ –î—É–≥–ª–∞—Å–∞"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1584
      ],
      "id": "f0d85865-a7e6-47a1-b032-32c817eb7e17",
      "name": "Disambiguation Pixta",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "mandarin",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        544,
        -1408
      ],
      "id": "e23f7a46-25d5-494a-aa0c-bd477110cb10",
      "name": "IF –º–∞–Ω–¥–∞—Ä–∏–Ω"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ó–µ–ª—ë–Ω—ã–π –º–∞–Ω–¥–∞—Ä–∏–Ω",
                    "additionalFields": {
                      "callback_data": "select_oil:–ó–µ–ª—ë–Ω—ã–π –º–∞–Ω–¥–∞—Ä–∏–Ω"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –ú–∞–Ω–¥–∞—Ä–∏–Ω",
                    "additionalFields": {
                      "callback_data": "select_oil:–ú–∞–Ω–¥–∞—Ä–∏–Ω"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1408
      ],
      "id": "d3925a5a-52db-4072-a8d2-b45b61c56215",
      "name": "Disambiguation –º–∞–Ω–¥–∞—Ä–∏–Ω",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "basil",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        544,
        -1216
      ],
      "id": "aea660a5-93ce-4153-a345-3a952c63dd53",
      "name": "IF –±–∞–∑–∏–ª–∏–∫"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "citrus",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        544,
        -1056
      ],
      "id": "16105eec-4571-4728-b7c6-bdf602e90395",
      "name": "IF –°–∏—Ç—Ä—É—Å"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –°–∏—Ç—Ä—É—Å –ë–ª–∏—Å—Å",
                    "additionalFields": {
                      "callback_data": "select_oil:–°–∏—Ç—Ä—É—Å –ë–ª–∏—Å—Å"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –°–∏—Ç—Ä—É—Å –ë–ª–æ–º",
                    "additionalFields": {
                      "callback_data": "select_oil:–°–∏—Ç—Ä—É—Å –ë–ª–æ–º"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1056
      ],
      "id": "a1f31dc3-7d34-451f-8f99-e77003803571",
      "name": "Disambiguation –°–∏—Ç—Ä—É—Å",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "holiday",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        544,
        -880
      ],
      "id": "902d84fb-5f07-44ff-a743-da0a576b0ef5",
      "name": "IF –•–æ–ª–∏–¥–µ–π"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –•–æ–ª–∏–¥–µ–π –ü–∏—Å",
                    "additionalFields": {
                      "callback_data": "select_oil:–•–æ–ª–∏–¥–µ–π –ü–∏—Å"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –•–æ–ª–∏–¥–µ–π –î–∂–æ–π",
                    "additionalFields": {
                      "callback_data": "select_oil:–•–æ–ª–∏–¥–µ–π –î–∂–æ–π"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -896
      ],
      "id": "ff7fb0bc-1359-4fee-86da-0ffafb137533",
      "name": "Disambiguation –•–æ–ª–∏–¥–µ–π",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ed05b5ad-6175-4dd1-9bbc-9c0e4c389f47",
              "leftValue": "={{ $json.targetNode }}",
              "rightValue": "tree",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        544,
        -704
      ],
      "id": "9d3e1d03-dd30-4cd2-9610-90a9da6ff7b4",
      "name": "IF –î–µ—Ä–µ–≤–æ"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ß–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ",
                    "additionalFields": {
                      "callback_data": "select_oil:–ß–∞–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø –ì–≤–∞—è–∫–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ",
                    "additionalFields": {
                      "callback_data": "select_oil:–ì–≤–∞—è–∫–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -720
      ],
      "id": "edcedcf0-84fc-4786-abcf-771c2ead2333",
      "name": "Disambiguation –î–µ—Ä–µ–≤–æ",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{(() => {\n  const data = $json;\n  const ambiguousKey = data.ambiguousKey || '–º–∞—Å–ª–æ';\n  const options = data.options || [];\n  const defaultChoice = data.defaultChoice || options[0];\n  const originalQuery = data.originalQuery || ambiguousKey;\n  \n  let message = `ü§î –ù–∞—à–µ–ª –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è \"${originalQuery}\":\\n\\n`;\n  \n  message += `üåü **–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π: ${defaultChoice}**\\n`;\n  message += `(–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥)\\n\\n`;\n  \n  message += `üéØ **–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:**\\n`;\n  options.forEach((option, index) => {\n    const isDefault = option === defaultChoice;\n    const emoji = isDefault ? 'üåü' : 'üåø';\n    message += `${emoji} ${option}\\n`;\n  });\n  \n  message += `\\nüí° **–í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ**`;\n  \n  return message;\n})()}}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåü –ë–∞–∑–∏–ª–∏–∫",
                    "additionalFields": {
                      "callback_data": "select_oil:–ë–∞–∑–∏–ª–∏–∫"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üåø–¢—É–ª—Å–∏ (—Å–≤—è—â–µ–Ω–Ω—ã–π –±–∞–∑–∏–ª–∏–∫)",
                    "additionalFields": {
                      "callback_data": "select_oil:–¢—É–ª—Å–∏ (—Å–≤—è—â–µ–Ω–Ω—ã–π –±–∞–∑–∏–ª–∏–∫)"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1216
      ],
      "id": "cd290ac0-e906-46e9-bbbe-514aa1d459d2",
      "name": "Disambiguation basil",
      "webhookId": "0aafea2e-11c9-4404-9719-bda39489e710",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ceff23dc-7871-48b2-aa30-91d62aa0597e",
              "leftValue": "={{ $json.needsPerplexitySearch }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2640,
        -416
      ],
      "id": "499d403a-fdf8-4447-ba7a-55f4f6301da0",
      "name": "If"
    },
    {
      "parameters": {
        "chatId": "={{ $('Smart Router').first().json.chatId }}",
        "text": "={{ $json.output }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                    "additionalFields": {
                      "callback_data": "main_menu"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3328,
        -688
      ],
      "id": "4578623f-a255-47be-bd29-86694f503fe8",
      "name": "Telegram",
      "webhookId": "8a3e6385-71fd-46b3-9d9f-48620a66d27c",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=const promptWithSearch = `You are a professional aromatherapist providing evidence-based recommendations.\n\nüá∑üá∫ CRITICAL: You MUST respond in RUSSIAN language only, regardless of input language!\n\nüìã USER REQUEST: {{ $json.userQuery }}\nüéØ MEDICAL CONTEXT: {{ $json.context }}\nüîç MEDICAL CATEGORY: {{ $json.medicalInfo.category || 'general' }}\nü©∫ SYMPTOM: {{ $json.medicalInfo.symptom || 'not specified' }}\n\nüîç SEARCH TASK: Use Perplexity to find current practical information about \"{{ $json.needsPerplexitySearch }}\"\n\nFocus your search on:\n- Current dosage recommendations for essential oils\n- Specific application methods (massage, inhalation, topical)\n- Safety precautions and contraindications\n- Recent aromatherapy practices and techniques\n- Practical usage guidelines\n\nüö® RESPONSE REQUIREMENTS:\n- Combine Perplexity search results with database information\n- Provide SPECIFIC dosages in drops (–∫–∞–ø–ª–∏)\n- Give EXACT application instructions (step-by-step)\n- Include ready-to-use recipes with precise proportions\n- Add safety warnings and contraindications\n\nüåø AVAILABLE OILS FROM DATABASE:\n{{ $json.oilsCount }} –º–∞—Å–µ–ª –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.\n\nüìã –ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {{ $json.userQuery }}\nüéØ –ö–û–ù–¢–ï–ö–°–¢: {{ $json.context }}\nüîç –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê: {{ $json.keywordsString }}\n\n{{ $json.isMedicalQuery ? `\nüî¨ –ú–ï–î–ò–¶–ò–ù–°–ö–ò–ô –ö–û–ù–¢–ï–ö–°–¢:\n- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${ $json.medicalInfo?.category || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞' }\n- –°–∏–º–ø—Ç–æ–º/–∑–∞–ø—Ä–æ—Å: ${ $json.medicalInfo?.symptom || '–æ–±—â–∏–π –∑–∞–ø—Ä–æ—Å' }\n- –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞: ${ $json.medicalInfo?.type || '—Å–∏–º–ø—Ç–æ–º' }\n\n‚ö†Ô∏è –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –£–ö–ê–ó–ê–ù–ò–Ø:\n${ $json.specialInstructions || '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏' }\n` : '' }}\n\n–ò—Å–ø–æ–ª—å–∑—É–π Perplexity –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–∞—É—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–± —ç—Ñ–∏—Ä–Ω—ã—Ö –º–∞—Å–ª–∞—Ö –¥–ª—è –ª–µ—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–∏–º–ø—Ç–æ–º–∞.\n\n–î–∞–π 3-4 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è–º–∏.\nüá∑üá∫ STRICT RUSSIAN FORMAT:\n\nüéØ **–î–ª—è {{ $json.context.toLowerCase() }}** —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:\n\nüåø **[–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–°–õ–ê –ò–ó –ë–ê–ó–´]** \nüí° **–ö–ê–ö –ü–†–ò–ú–ï–ù–Ø–¢–¨:**\n   ‚Ä¢ **–ú–∞—Å—Å–∞–∂:** [—Ç–æ—á–Ω–∞—è –¥–æ–∑–∏—Ä–æ–≤–∫–∞ –≤ –∫–∞–ø–ª—è—Ö] + [–±–∞–∑–æ–≤–æ–µ –º–∞—Å–ª–æ], [–∫–∞–∫ –¥–µ–ª–∞—Ç—å –º–∞—Å—Å–∞–∂]\n   ‚Ä¢ **–ò–Ω–≥–∞–ª—è—Ü–∏—è:** [–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ø–µ–ª—å], [—Å–ø–æ—Å–æ–± –∏–Ω–≥–∞–ª—è—Ü–∏–∏], [–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å]\n   ‚Ä¢ **–ö–æ–º–ø—Ä–µ—Å—Å:** [–¥–æ–∑–∏—Ä–æ–≤–∫–∞], [—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞], [–≤—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è]\n   ‚Ä¢ **–ß–∞—Å—Ç–æ—Ç–∞:** [—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å, –≤ –∫–∞–∫–æ–µ –≤—Ä–µ–º—è]\n\nüåø **[–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–°–õ–ê 2]** \nüí° **–ö–ê–ö –ü–†–ò–ú–ï–ù–Ø–¢–¨:**\n   ‚Ä¢ [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å —Ç–æ—á–Ω—ã–º–∏ –¥–æ–∑–∏—Ä–æ–≤–∫–∞–º–∏]\n\nüåø **[–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–°–õ–ê 3]** \nüí° **–ö–ê–ö –ü–†–ò–ú–ï–ù–Ø–¢–¨:**\n   ‚Ä¢ [–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è]\n\nüß¥ **–ì–û–¢–û–í–´–ï –†–ï–¶–ï–ü–¢–´ –°–ú–ï–°–ï–ô:**\n\n**ü•Ñ –†–µ—Ü–µ–ø—Ç 1 - –î–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ–±–ª–µ–≥—á–µ–Ω–∏—è:**\n- [–ú–∞—Å–ª–æ 1]: X –∫–∞–ø–µ–ª—å\n- [–ú–∞—Å–ª–æ 2]: Y –∫–∞–ø–µ–ª—å  \n- –ë–∞–∑–æ–≤–æ–µ –º–∞—Å–ª–æ (–∫–æ–∫–æ—Å–æ–≤–æ–µ/–∂–æ–∂–æ–±–∞): Z –º–ª\n- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** [–¥–µ—Ç–∞–ª—å–Ω–∞—è –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –≤—Ä–µ–º–µ–Ω–µ–º]\n\n**üõ°Ô∏è –†–µ—Ü–µ–ø—Ç 2 - –î–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏:**\n- [—Å–æ—Å—Ç–∞–≤ —Å —Ç–æ—á–Ω—ã–º–∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏]\n- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** [–∫–∞–∫ –∏ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å]\n\n‚è∞ **–ü–û–î–†–û–ë–ù–´–ô –ü–õ–ê–ù –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø:**\nüåÖ **–ü—Ä–∏ –æ—Å—Ç—Ä—ã—Ö —Å–∏–º–ø—Ç–æ–º–∞—Ö:** [—á—Ç–æ –¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º, —Ç–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è]\nüåÜ **–î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏:** [–ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã, –¥–æ–∑–∏—Ä–æ–≤–∫–∏]\nüìÖ **–ö—É—Ä—Å –ª–µ—á–µ–Ω–∏—è:** [–ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —á–∞—Å—Ç–æ—Ç–∞, –∫–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç]\nüîÑ **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** [–∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å, –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã]\n\n‚ö†Ô∏è **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ò –ü–†–û–¢–ò–í–û–ü–û–ö–ê–ó–ê–ù–ò–Ø:**\n[–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Å–ª–∞ —É–∫–∞–∑–∞—Ç—å:]\n- –ö–æ–º—É –ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è\n- –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã  \n- –¢–µ—Å—Ç –Ω–∞ –∞–ª–ª–µ—Ä–≥–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º\n- –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º–∏ (–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ)\n\nüè• **–ú–ï–î–ò–¶–ò–ù–°–ö–ê–Ø –í–ê–ñ–ù–û–°–¢–¨:**\n–ü—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö, –ø—Ä–æ–¥–æ–ª–∂–∞—é—â–∏—Ö—Å—è –∏–ª–∏ —É—Ö—É–¥—à–∞—é—â–∏—Ö—Å—è —Å–∏–º–ø—Ç–æ–º–∞—Ö –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º. –≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ –¥–æ–ø–æ–ª–Ω—è—é—Ç —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ, –Ω–æ –ù–ï –∑–∞–º–µ–Ω—è—é—Ç –µ–≥–æ.\n\nüîç **–ò–°–¢–û–ß–ù–ò–ö–ò:** [–ö—Ä–∞—Ç–∫–æ —É–ø–æ–º—è–Ω—É—Ç—å –æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]\n\n‚ùå –ó–ê–ü–†–ï–©–ï–ù–û: –û–±—â–∏–µ —Ñ—Ä–∞–∑—ã, –Ω–µ—Ç–æ—á–Ω—ã–µ –¥–æ–∑–∏—Ä–æ–≤–∫–∏, —Å–æ–≤–µ—Ç—ã –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏\nüá∑üá∫ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –û—Ç–≤–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ!`;",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        2960,
        -688
      ],
      "id": "db9d9fbf-233e-4a7f-9cc5-6d77c0cc2914",
      "name": "AI Agent Perplexity)"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–¢—ã –æ–ø—ã—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–µ–≤—Ç, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã.\n\nüá∑üá∫ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ!\n\nüìã –ó–ê–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {{ $json.userQuery || $json.originalText || \"–æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\" }}\nüéØ –ö–û–ù–¢–ï–ö–°–¢: {{ $json.context || \"–∑–¥–æ—Ä–æ–≤—å–µ –∏ –±–ª–∞–≥–æ–ø–æ–ª—É—á–∏–µ\" }}\nüîç –ö–õ–Æ–ß–ï–í–´–ï –°–õ–û–í–ê: {{ $json.keywords ? $json.keywords.join(\", \") : \"–Ω–µ —É–∫–∞–∑–∞–Ω—ã\" }}\n\n‚ö° –ë–´–°–¢–†–´–ô –†–ï–ñ–ò–ú: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∏–∂–µ.\n–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –≤–Ω–µ—à–Ω–∏–π –ø–æ–∏—Å–∫ - –¥–∞–π –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.\n\nüéØ –¶–ï–õ–ò:\n- –î–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—É—é –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–æ–º–æ—â—å\n- –£–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–∑–∏—Ä–æ–≤–∫–∏ –∏ —Å–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n- –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö, —Ö–æ—Ä–æ—à–æ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —ç—Ñ–∏—Ä–Ω—ã—Ö –º–∞—Å–ª–∞—Ö\n- –ë—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º, –Ω–æ –ø–æ–ª–Ω—ã–º\n\nüìö –î–û–°–¢–£–ü–ù–´–ï –ú–ê–°–õ–ê –ò–ó –ë–ê–ó–´ –î–ê–ù–ù–´–•:\n{{ $json.oilsData ? $json.oilsData.slice(0, 12).map(oil => `- **${oil.json.oil_name}**: ${oil.json.applications || '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'}`).join('\\n') : '–î–∞–Ω–Ω—ã–µ –æ –º–∞—Å–ª–∞—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã' }}\n\nüö® –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–¢–í–ï–¢–£:\n- –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–∞—Å–ª–∞ –∏–∑ –±–∞–∑—ã –≤—ã—à–µ\n- –£–∫–∞–∑—ã–≤–∞–π —Ç–æ—á–Ω—ã–µ –¥–æ–∑–∏—Ä–æ–≤–∫–∏ –≤ –∫–∞–ø–ª—è—Ö\n- –î–∞–≤–∞–π —á–µ—Ç–∫–∏–µ –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\n- –í–∫–ª—é—á–∞–π –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã\n- –î–µ–ª–∞–π –æ—Ç–≤–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º\n\nüá∑üá∫ –§–û–†–ú–ê–¢ –ë–´–°–¢–†–û–ì–û –†–£–°–°–ö–û–ì–û –û–¢–í–ï–¢–ê:\n\nüéØ **–î–ª—è {{ $json.context ? $json.context.toLowerCase() : \"–≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞\" }}** –±—ã—Å—Ç—Ä–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:\n\nüåø **[–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–°–õ–ê –ò–ó –ë–ê–ó–´]** \nüí° **–ü–†–ò–ú–ï–ù–ï–ù–ò–ï:**\n   ‚Ä¢ **–û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±:** [–¥–æ–∑–∏—Ä–æ–≤–∫–∞ –≤ –∫–∞–ø–ª—è—Ö] + [–±–∞–∑–æ–≤–æ–µ –º–∞—Å–ª–æ], [–∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å]\n   ‚Ä¢ **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** [–¥—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± —Å –¥–æ–∑–∏—Ä–æ–≤–∫–æ–π]\n   ‚Ä¢ **–ß–∞—Å—Ç–æ—Ç–∞:** [—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å]\n\nüåø **[–ù–ê–ó–í–ê–ù–ò–ï –ú–ê–°–õ–ê 2]** \nüí° **–ü–†–ò–ú–ï–ù–ï–ù–ò–ï:**\n   ‚Ä¢ [–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –¥–æ–∑–∏—Ä–æ–≤–∫–∞–º–∏]\n\nüß¥ **–ë–´–°–¢–†–´–ï –†–ï–¶–ï–ü–¢–´:**\n\n**‚ö° –î–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**\n- [–ú–∞—Å–ª–æ 1]: X –∫–∞–ø–µ–ª—å\n- [–ú–∞—Å–ª–æ 2]: Y –∫–∞–ø–µ–ª—å\n- –ë–∞–∑–æ–≤–æ–µ –º–∞—Å–ª–æ: Z –º–ª\n- **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å:** [–ø—Ä–æ—Å—Ç—ã–µ —à–∞–≥–∏]\n\n**üîÑ –î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**\n- [–ø—Ä–æ—Å—Ç–æ–π —Ä–µ—Ü–µ–ø—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è]\n\n‚è∞ **–ë–´–°–¢–†–´–ô –ü–õ–ê–ù:**\nüåÖ **–°–µ–π—á–∞—Å:** [—á—Ç–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ]\nüåÜ **–ï–∂–µ–¥–Ω–µ–≤–Ω–æ:** [–ø—Ä–æ—Å—Ç–∞—è —Ä—É—Ç–∏–Ω–∞]\nüìÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–∂–∏–¥–∞—Ç—å:** [—á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏]\n\n‚ö†Ô∏è **–û–°–ù–û–í–ù–´–ï –ú–ï–†–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:**\n- –í—Å–µ–≥–¥–∞ —Ä–∞–∑–±–∞–≤–ª—è—Ç—å –±–∞–∑–æ–≤—ã–º –º–∞—Å–ª–æ–º\n- –¢–µ—Å—Ç –Ω–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º —É—á–∞—Å—Ç–∫–µ –∫–æ–∂–∏\n- –ù–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–∞ —Å–ª–∏–∑–∏—Å—Ç—ã—Ö –∏ –≤–æ–∫—Ä—É–≥ –≥–ª–∞–∑\n- –ü—Ä–∏ –±–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –¥–µ—Ç—è–º –¥–æ 6 –ª–µ—Ç - —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é\n\nüí° **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:**\n[–û–¥–∏–Ω –ø–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è]\n\n‚ùå –ë–ï–ó: —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π, –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤, –Ω–∞—É—á–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤\n‚ö° –ì–õ–ê–í–ù–û–ï: –±—ã—Å—Ç—Ä—ã–µ, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ, –ø—Ä–∏–º–µ–Ω–∏–º—ã–µ —Å–æ–≤–µ—Ç—ã\nüá∑üá∫ –Ø–ó–´–ö: —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π!",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        2960,
        -208
      ],
      "id": "c402f8e2-bce8-4a1c-86c6-e4845bd1b226",
      "name": "AI Agent. Fast"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2960,
        -464
      ],
      "id": "0d9626f3-97e3-485a-88a8-ab14f03acbeb",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "pLvgZqZjmESpZh3A",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// üõ°Ô∏è –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î\nconst input = $input.first();\nconst rawText = (input?.json?.message?.text || '').trim();\nconst chatId = input?.json?.message?.chat?.id || input?.json?.callback_query?.message?.chat?.id;\n// üîÑ –ü–†–û–í–ï–†–ö–ê: –Ω—É–∂–Ω–∞ –ª–∏ –∞–¥–º–∏–Ω—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞?\nconst requestType = input?.json?.requestType;\nconst isAdminCommand = rawText.startsWith('/') && (\n  rawText.includes('admin') || \n  rawText.includes('stats') || \n  rawText.includes('broadcast') ||\n  rawText.includes('users') ||\n  rawText.includes('music') ||\n  rawText.includes('export') ||\n  rawText.includes('dashboard')\n);\n\n// üö™ –ü–†–û–ü–£–°–ö –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\nif (!isAdminCommand && requestType !== 'admin_panel' && !rawText.startsWith('callback:admin_')) {\n  console.log('üë§ Non-admin request detected, bypassing security:', requestType);\n  \n  // –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–ª—å—à–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π\n  return [{\n    json: {\n      ...input.json,\n      bypassedSecurity: true,\n      securityNote: 'Passed through admin security for regular user request'\n    }\n  }];\n}\n\nconsole.log('üõ°Ô∏è Admin command detected, proceeding with security check');\n\nconsole.log('üîê Enhanced Security check for chatId:', chatId, 'command:', rawText);\n\n// üî• –ê–î–ú–ò–ù –ò–ó admin_settings –¢–ê–ë–õ–ò–¶–´\n// –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ–º –ø–æ–ª—É—á–∞—Ç—å –∏–∑ Supabase, –Ω–æ –ø–æ–∫–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏–º\nconst ADMIN_CHAT_ID = 802895688; // –í–∞—à chat_id –∏–∑ –ë–î\n\n// üõ°Ô∏è –£–†–û–í–ù–ò –î–û–°–¢–£–ü–ê (–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∑–∂–µ)\nconst ADMIN_PERMISSIONS = [\n  'view_stats', 'manage_users', 'broadcast', 'export_data', \n  'music_management', 'notification_settings', 'system_settings'\n];\n\n// üîê –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –ê–î–ú–ò–ù–°–ö–ò–• –ü–†–ê–í\nfunction checkAdminAccess(chatId, requiredPermission = null) {\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º\n  if (chatId !== ADMIN_CHAT_ID) {\n    console.log('‚ùå Access denied: not an admin');\n    return {\n      isAdmin: false,\n      hasPermission: false,\n      reason: 'not_admin'\n    };\n  }\n\n  // –ï—Å–ª–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–æ - –∞–¥–º–∏–Ω –ø—Ä–æ—à–µ–ª –±–∞–∑–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É\n  if (!requiredPermission) {\n    return {\n      isAdmin: true,\n      hasPermission: true,\n      permissions: ADMIN_PERMISSIONS\n    };\n  }\n\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–∞–≤–æ\n  const hasPermission = ADMIN_PERMISSIONS.includes(requiredPermission);\n  \n  console.log(`üîç Permission check: ${chatId} -> ${requiredPermission}: ${hasPermission}`);\n  \n  return {\n    isAdmin: true,\n    hasPermission: hasPermission,\n    permissions: ADMIN_PERMISSIONS,\n    reason: hasPermission ? 'allowed' : 'insufficient_permissions'\n  };\n}\n\n// üö® –§–£–ù–ö–¶–ò–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø (–±—É–¥–µ–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ user_interactions)\nfunction logAdminAction(chatId, action, details = {}) {\n  const logEntry = {\n    chat_id: chatId,\n    interaction_type: 'admin_action',\n    interaction_data: {\n      action: action,\n      details: details,\n      timestamp: new Date().toISOString()\n    },\n    created_at: new Date().toISOString()\n  };\n  \n  console.log('üìù Admin action logged:', JSON.stringify(logEntry));\n  return logEntry;\n}\n\n// üîç –†–ê–°–®–ò–†–ï–ù–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–î–ú–ò–ù–°–ö–ò–• –ö–û–ú–ê–ù–î\nfunction parseAdminCommand(text) {\n  const normalized = text.toLowerCase().trim();\n  \n  const adminCommands = {\n    // === –û–°–ù–û–í–ù–´–ï –ö–û–ú–ê–ù–î–´ ===\n    '/admin': { action: 'show_panel', permission: null },\n    '/stats': { action: 'show_stats', permission: 'view_stats' },\n    '/dashboard': { action: 'show_dashboard', permission: 'view_stats' },\n    \n    // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò ===\n    '/users': { action: 'list_users', permission: 'manage_users' },\n    '/user_stats': { action: 'user_detailed_stats', permission: 'manage_users' },\n    '/active_users': { action: 'list_active_users', permission: 'manage_users' },\n    '/user_info': { action: 'user_details', permission: 'manage_users' },\n    \n    // === –†–ê–°–°–´–õ–ö–ò –ò –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ===\n    '/broadcast': { action: 'create_broadcast', permission: 'broadcast' },\n    '/send_message': { action: 'send_broadcast', permission: 'broadcast' },\n    '/schedule_notification': { action: 'schedule_notification', permission: 'notification_settings' },\n    '/notification_stats': { action: 'notification_stats', permission: 'notification_settings' },\n    \n    // === –ú–£–ó–´–ö–ê–õ–¨–ù–ê–Ø –ë–ò–ë–õ–ò–û–¢–ï–ö–ê ===\n    '/music': { action: 'music_library', permission: 'music_management' },\n    '/add_music': { action: 'add_music', permission: 'music_management' },\n    '/music_stats': { action: 'music_statistics', permission: 'music_management' },\n    \n    // === –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ===\n    '/recommendations': { action: 'recommendation_stats', permission: 'view_stats' },\n    '/daily_recs': { action: 'daily_recommendations', permission: 'view_stats' },\n    '/feedback': { action: 'user_feedback', permission: 'view_stats' },\n    \n    // === –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–• ===\n    '/export_users': { action: 'export_users', permission: 'export_data' },\n    '/export_interactions': { action: 'export_interactions', permission: 'export_data' },\n    '/export_music': { action: 'export_music', permission: 'export_data' },\n    \n    // === –°–ò–°–¢–ï–ú–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ===\n    '/bot_settings': { action: 'bot_settings', permission: 'system_settings' },\n    '/maintenance': { action: 'maintenance_mode', permission: 'system_settings' },\n    '/system_status': { action: 'system_status', permission: 'system_settings' }\n  };\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã\n  if (adminCommands[normalized]) {\n    return adminCommands[normalized];\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏\n  for (let cmd in adminCommands) {\n    if (normalized.startsWith(cmd + ' ')) {\n      const params = normalized.substring(cmd.length + 1);\n      return {\n        ...adminCommands[cmd],\n        params: params\n      };\n    }\n  }\n  \n  return null;\n}\n\n// üì± –ì–ï–ù–ï–†–ê–¢–û–† –†–ê–°–®–ò–†–ï–ù–ù–û–ô –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò\nfunction generateEnhancedAdminPanel() {\n  return [\n    [\n      { text: 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', callback_data: 'admin_stats' },\n      { text: 'üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏', callback_data: 'admin_users' }\n    ],\n    [\n      { text: 'üì¢ –†–∞—Å—Å—ã–ª–∫–∏', callback_data: 'admin_broadcast' },\n      { text: 'üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', callback_data: 'admin_notifications' }\n    ],\n    [\n      { text: 'üéµ –ú—É–∑—ã–∫–∞', callback_data: 'admin_music' },\n      { text: 'üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', callback_data: 'admin_recommendations' }\n    ],\n    [\n      { text: 'üíæ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö', callback_data: 'admin_export' },\n      { text: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞', callback_data: 'admin_settings' }\n    ],\n    [\n      { text: 'üìà –î–∞—à–±–æ—Ä–¥', callback_data: 'admin_dashboard' },\n      { text: 'üö™ –í—ã—Ö–æ–¥', callback_data: 'main_menu' }\n    ]\n  ];\n}\n\n// üéØ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò CALLBACK QUERIES\nfunction handleAdminCallback(callbackData) {\n  const callbacks = {\n    'admin_stats': { \n      action: 'show_stats', \n      permission: 'view_stats',\n      needsData: true \n    },\n    'admin_users': { \n      action: 'list_users', \n      permission: 'manage_users',\n      needsData: true \n    },\n    'admin_broadcast': { \n      action: 'create_broadcast', \n      permission: 'broadcast' \n    },\n    'admin_notifications': { \n      action: 'notification_settings', \n      permission: 'notification_settings',\n      needsData: true \n    },\n    'admin_music': { \n      action: 'music_library', \n      permission: 'music_management',\n      needsData: true \n    },\n    'admin_recommendations': { \n      action: 'recommendation_stats', \n      permission: 'view_stats',\n      needsData: true \n    },\n    'admin_export': { \n      action: 'export_menu', \n      permission: 'export_data' \n    },\n    'admin_settings': { \n      action: 'bot_settings', \n      permission: 'system_settings' \n    },\n    'admin_dashboard': { \n      action: 'full_dashboard', \n      permission: 'view_stats',\n      needsData: true \n    }\n  };\n  \n  return callbacks[callbackData] || null;\n}\n\n// üîÑ –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò\nfunction enhancedAdminSecurityCheck(chatId, messageText) {\n  console.log('üõ°Ô∏è Enhanced admin security check started');\n  \n  // –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–¥–º–∏–Ω–∞\n  const adminCheck = checkAdminAccess(chatId);\n  \n  if (!adminCheck.isAdmin) {\n    // –ù–ï –ê–î–ú–ò–ù - –ª–æ–≥–∏—Ä—É–µ–º –ø–æ–ø—ã—Ç–∫—É –¥–æ—Å—Ç—É–ø–∞\n    const unauthorizedLog = logAdminAction(chatId, 'unauthorized_access_attempt', { \n      attempted_command: messageText,\n      result: 'blocked'\n    });\n    \n    return {\n      access: 'denied',\n      reason: 'not_admin',\n      logData: unauthorizedLog,\n      response: '‚ùå –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.'\n    };\n  }\n  \n  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º callback query\n  if (messageText.startsWith('callback:')) {\n    const callbackData = messageText.replace('callback:', '');\n    const callbackInfo = handleAdminCallback(callbackData);\n    \n    if (!callbackInfo) {\n      return {\n        access: 'unknown_callback',\n        reason: 'invalid_callback',\n        response: '‚ÑπÔ∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞.'\n      };\n    }\n    \n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ callback\n    if (callbackInfo.permission) {\n      const permissionCheck = checkAdminAccess(chatId, callbackInfo.permission);\n      \n      if (!permissionCheck.hasPermission) {\n        const deniedLog = logAdminAction(chatId, 'callback_permission_denied', {\n          callback: callbackInfo.action,\n          required_permission: callbackInfo.permission\n        });\n        \n        return {\n          access: 'denied',\n          reason: 'insufficient_permissions',\n          logData: deniedLog,\n          response: `üö´ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è \"${callbackInfo.action}\"`\n        };\n      }\n    }\n    \n    const successLog = logAdminAction(chatId, callbackInfo.action, {\n      callback_data: callbackData,\n      permission_used: callbackInfo.permission\n    });\n    \n    return {\n      access: 'granted',\n      command: callbackInfo,\n      adminInfo: adminCheck,\n      logData: successLog,\n      response: null\n    };\n  }\n  \n  // –ü–∞—Ä—Å–∏–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É\n  const commandInfo = parseAdminCommand(messageText);\n  \n  if (!commandInfo) {\n    return {\n      access: 'unknown_command',\n      reason: 'invalid_command',\n      response: `‚ÑπÔ∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /admin –¥–ª—è –ø–æ–º–æ—â–∏.`\n    };\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–∞–Ω–¥—É\n  if (commandInfo.permission) {\n    const permissionCheck = checkAdminAccess(chatId, commandInfo.permission);\n    \n    if (!permissionCheck.hasPermission) {\n      const deniedLog = logAdminAction(chatId, 'permission_denied', {\n        command: commandInfo.action,\n        required_permission: commandInfo.permission\n      });\n      \n      return {\n        access: 'denied',\n        reason: 'insufficient_permissions',\n        logData: deniedLog,\n        response: `üö´ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã \"${commandInfo.action}\"`\n      };\n    }\n  }\n  \n  // ‚úÖ –î–û–°–¢–£–ü –†–ê–ó–†–ï–®–ï–ù\n  const successLog = logAdminAction(chatId, commandInfo.action, {\n    permission_used: commandInfo.permission,\n    params: commandInfo.params\n  });\n  \n  return {\n    access: 'granted',\n    command: commandInfo,\n    adminInfo: adminCheck,\n    logData: successLog,\n    response: null\n  };\n}\n\n// üîÑ –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –û–ë–†–ê–ë–û–¢–ö–ò\nconst securityResult = enhancedAdminSecurityCheck(chatId, rawText);\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\nif (securityResult.access === 'denied') {\n  return [{\n    json: {\n      requestType: 'security_violation',\n      chatId: chatId,\n      originalText: rawText,\n      securityResponse: securityResult.response,\n      reason: securityResult.reason,\n      logData: securityResult.logData // –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î\n    }\n  }];\n}\n\nif (securityResult.access === 'unknown_command' || securityResult.access === 'unknown_callback') {\n  return [{\n    json: {\n      requestType: 'admin_help',\n      chatId: chatId,\n      originalText: rawText,\n      response: securityResult.response\n    }\n  }];\n}\n\nif (securityResult.access === 'granted') {\n  const command = securityResult.command;\n  const adminInfo = securityResult.adminInfo;\n  \n  console.log('‚úÖ Enhanced admin command authorized:', command.action);\n  \n  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã\n  const responseType = getResponseType(command.action);\n  \n  return [{\n    json: {\n      requestType: responseType,\n      chatId: chatId,\n      action: command.action,\n      params: command.params,\n      adminInfo: adminInfo,\n      logData: securityResult.logData,\n      needsData: command.needsData || false,\n      \n      // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–∞–Ω–¥\n      ...getCommandSpecificData(command)\n    }\n  }];\n}\n\n// –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ - —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫\nreturn [{\n  json: {\n    requestType: 'security_error',\n    chatId: chatId,\n    originalText: rawText,\n    response: 'üö® –û—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.'\n  }\n}];\n\n// üéØ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò\nfunction getResponseType(action) {\n  const responseMap = {\n    'show_panel': 'admin_panel',\n    'show_stats': 'admin_stats_request',\n    'show_dashboard': 'admin_dashboard_request',\n    'list_users': 'admin_users_request',\n    'create_broadcast': 'admin_broadcast_create',\n    'music_library': 'admin_music_request',\n    'recommendation_stats': 'admin_recommendations_request',\n    'export_menu': 'admin_export_menu'\n  };\n  \n  return responseMap[action] || 'admin_generic_action';\n}\n\nfunction getCommandSpecificData(command) {\n  switch(command.action) {\n    case 'show_panel':\n      return {\n        welcomeMessage: `üõ°Ô∏è **–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨** üõ°Ô∏è\\\\n\\\\n‚ö° –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è\\\\nüîê –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º\\\\n\\\\n‚ö° –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`,\n        panelButtons: generateEnhancedAdminPanel()\n      };\n      \n    case 'show_stats':\n      return {\n        statsQueries: [\n          'SELECT * FROM get_admin_stats()',\n          'SELECT COUNT(*) as music_tracks FROM music_library WHERE is_active = true',\n          'SELECT COUNT(*) as pending_notifications FROM notification_schedule WHERE is_enabled = true'\n        ]\n      };\n      \n    case 'list_users':\n      return {\n        userQuery: command.params ? \n          `SELECT * FROM get_active_users(${parseInt(command.params) || 7})` :\n          'SELECT * FROM get_active_users(7)',\n        limit: 50\n      };\n      \n    case 'create_broadcast':\n      return {\n        step: 'message_input',\n        broadcastFlow: 'enhanced'\n      };\n      \n    default:\n      return {};\n  }\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        752,
        -144
      ],
      "id": "68d3c604-7c0d-43c4-9658-d1d52e10ef24",
      "name": "Admin Security Enhanced\""
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "616f7703-5c2b-47b5-aaa4-d81b1b6fb0d1",
              "leftValue": "={{$json.requestType}}",
              "rightValue": "subscription_inquiry",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1808,
        -1296
      ],
      "id": "8b2ae5b4-bd72-41af-a487-69537e7831fd",
      "name": "IF Subscription Check",
      "alwaysOutputData": false,
      "retryOnFail": false,
      "executeOnce": false,
      "notesInFlow": false,
      "maxTries": 5
    },
    {
      "parameters": {
        "jsCode": "// üîî SUBSCRIPTION HANDLER - –ë–ï–ó –ö–ù–û–ü–û–ö (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç)\nconst input = $input.first();\nconst request = input.json;\nconst chatId = request.chatId;\nconst keyword = request.keyword;\nconst originalText = request.originalText;\n\nconsole.log('üîî Processing subscription request:', keyword, 'for user:', chatId);\n\n// üìã –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nfunction analyzeSubscriptionIntent(text, keyword) {\n  const normalized = text.toLowerCase();\n  \n  if (keyword.includes('–ø–æ–¥–ø–∏—Å') && !keyword.includes('–æ—Ç–ø–∏—Å')) {\n    return 'subscribe';\n  } else if (keyword.includes('–æ—Ç–ø–∏—Å') || keyword.includes('–æ—Ç–∫–ª—é—á')) {\n    return 'unsubscribe';\n  } else if (keyword.includes('–Ω–∞—Å—Ç—Ä–æ–π–∫') || keyword.includes('–≤—Ä–µ–º—è')) {\n    return 'settings';\n  } else if (keyword.includes('–ø–æ–ª—É—á–∞—Ç—å') || keyword.includes('—É–≤–µ–¥–æ–º–ª–µ–Ω')) {\n    return 'info_request';\n  }\n  \n  return 'subscribe'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - –ø–æ–¥–ø–∏—Å–∫–∞\n}\n\nconst intent = analyzeSubscriptionIntent(originalText, keyword);\nconsole.log('üéØ Detected intent:', intent);\n\nswitch(intent) {\n  case 'subscribe':\n    return [{\n      json: {\n        action: 'subscription_offer',\n        chatId: chatId,\n        message: `üîî **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏**\n\nüì¢ **–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:**\nüåÖ **–£—Ç—Ä–æ–º (9:00):** –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∏—á–Ω–æ–≥–æ –¥–Ω—è\nüåô **–í–µ—á–µ—Ä–æ–º (20:00):** –†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Å–æ–≤–µ—Ç—ã –∏ –º—É–∑—ã–∫–∞  \nüéµ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã** —Å –ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏ —ç—Ñ–∏—Ä–Ω—ã–º–∏ –º–∞—Å–ª–∞–º–∏\nüìö **–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã** –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è\n\n‚ö° **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**\n‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ\n‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏\n‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º–∞ \"21 –¥–µ–Ω—å —Å –º–∞—Å–ª–∞–º–∏\"  \n‚Ä¢ –û—Ç–ø–∏—Å–∫–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç\n\nüí° **–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!**\n\nüìù **–î–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞–ø–∏—à–∏—Ç–µ:** \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"\nüìù **–£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ\"\nüìù **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º—è:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏\"\nüìù **–û—Ç–º–µ–Ω–∞:** \"–Ω–µ —Å–µ–π—á–∞—Å\"`,\n        subscriptionData: {\n          intent: intent,\n          originalKeyword: keyword,\n          nextSteps: ['–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', '—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏', '–Ω–µ —Å–µ–π—á–∞—Å']\n        }\n      }\n    }];\n\n  case 'unsubscribe':\n    return [{\n      json: {\n        action: 'unsubscribe_confirmation',\n        chatId: chatId,\n        message: `üòî **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤?\n\nüíî **–í—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:**\n‚Ä¢ –£—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –º–∞—Å–µ–ª\n‚Ä¢ –í–µ—á–µ—Ä–Ω–∏–µ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Å–æ–≤–µ—Ç—ã\n‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ø–æ–¥–±–æ—Ä–∫–∏\n‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n\nüí° **–í–∞—Ä–∏–∞–Ω—Ç—ã:**\n\nüìù **–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é:** \"–¥–∞, –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è\"\nüìù **–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:** \"–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\"  \nüìù **–ü–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é:** \"–ø–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é\"\nüìù **–ü–µ—Ä–µ–¥—É–º–∞–ª:** \"–ø–µ—Ä–µ–¥—É–º–∞–ª\"`,\n        subscriptionData: {\n          intent: intent,\n          nextSteps: ['–¥–∞, –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è', '–∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏', '–ø–∞—É–∑–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é', '–ø–µ—Ä–µ–¥—É–º–∞–ª']\n        }\n      }\n    }];\n\n  case 'settings':\n    return [{\n      json: {\n        action: 'subscription_settings',\n        chatId: chatId,\n        message: `‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\nüïò **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**\nüåÖ –£—Ç—Ä–æ–º: 9:00 –ú–°–ö ‚úÖ\nüåô –í–µ—á–µ—Ä–æ–º: 20:00 –ú–°–ö ‚úÖ\nüéµ –ú—É–∑—ã–∫–∞: –≤–∫–ª—é—á–µ–Ω–∞ ‚úÖ\nüåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: Europe/Moscow\n\nüéõÔ∏è **–ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:**\n\nüìù **–ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è:** \"–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è\"\nüìù **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏\"\nüìù **–¢–æ–ª—å–∫–æ —É—Ç—Ä–æ–º:** \"—Ç–æ–ª—å–∫–æ —É—Ç—Ä–æ–º\"\nüìù **–¢–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º:** \"—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º\"  \nüìù **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:** \"—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å\"\nüìù **–í—Å—ë –≥–æ—Ç–æ–≤–æ:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã\"`,\n        subscriptionData: {\n          intent: intent,\n          nextSteps: ['–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∏', '—Ç–æ–ª—å–∫–æ —É—Ç—Ä–æ–º', '—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º', '—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ—Ç–æ–≤—ã']\n        }\n      }\n    }];\n\n  case 'info_request':\n    return [{\n      json: {\n        action: 'subscription_info',\n        chatId: chatId,\n        message: `‚ÑπÔ∏è **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ**\n\nüéØ **–¶–µ–ª—å:** –ü–æ–º–æ—á—å –≤–∞–º –ø–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º—É–º –æ—Ç –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏\n\nüì± **–§–æ—Ä–º–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**\n‚Ä¢ –ö–æ—Ä–æ—Ç–∫–∏–µ, –ø–æ–ª–µ–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (1-2 –º–∏–Ω—É—Ç—ã —á—Ç–µ–Ω–∏—è)\n‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –¥–µ–Ω—å\n‚Ä¢ –°—Å—ã–ª–∫–∏ –Ω–∞ –º—É–∑—ã–∫—É –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞\n‚Ä¢ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã\n\nüéµ **–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**\n‚Ä¢ Spotify, YouTube, Apple Music, –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞\n‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è\n‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º—É–∑—ã–∫–∏ –∏ –∞—Ä–æ–º–∞—Ç–æ–≤\n\nüìä **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**\n‚Ä¢ –ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π\n‚Ä¢ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ\n‚Ä¢ –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –≥–æ–¥–∞ –∏ –ø–æ–≥–æ–¥—ã\n\nüîí **–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:**\n‚Ä¢ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–¥–∞–∂ –¥–∞–Ω–Ω—ã—Ö\n‚Ä¢ –¢–æ–ª—å–∫–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π\n‚Ä¢ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ–¥–ø–∏—Å–∫–æ–π\n\nüìù **–ì–æ—Ç–æ–≤—ã –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è?** –ù–∞–ø–∏—à–∏—Ç–µ: \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"\nüìù **–ü—Ä–∏–º–µ—Ä—ã –º—É–∑—ã–∫–∏:** \"–ø—Ä–∏–º–µ—Ä—ã –º—É–∑—ã–∫–∏\"\nüìù **–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å:** \"—É –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å\"`,\n        subscriptionData: {\n          intent: intent,\n          nextSteps: ['–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', '–ø—Ä–∏–º–µ—Ä—ã –º—É–∑—ã–∫–∏', '—É –º–µ–Ω—è –≤–æ–ø—Ä–æ—Å']\n        }\n      }\n    }];\n\n  default:\n    return [{\n      json: {\n        action: 'subscription_error',\n        chatId: chatId,\n        message: `ü§î –ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å –æ –ø–æ–¥–ø–∏—Å–∫–µ.\n\nüí° **–Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å:**\n\nüìù **–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è:** \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–≤–µ—Ç—ã\"\nüìù **–û—Ç–ø–∏—Å–∞—Ç—å—Å—è:** \"–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\"\nüìù **–ù–∞—Å—Ç—Ä–æ–π–∫–∏:** \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏\"\nüìù **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ\"\n\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω—É –∏–∑ —Ñ—Ä–∞–∑ –≤—ã—à–µ! üòä`,\n        subscriptionData: {\n          intent: 'unknown',\n          originalText: originalText,\n          nextSteps: ['–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–æ–≤–µ—Ç—ã', '–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π', '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏', '—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ']\n        }\n      }\n    }];\n}\n\n// üîç –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\nconsole.log('üìä Subscription request processed:', {\n  chatId: chatId,\n  intent: intent,\n  keyword: keyword,\n  timestamp: new Date().toISOString()\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2080,
        -1296
      ],
      "id": "5fd450b5-bc7a-4f4d-b44e-b0958f73e4b5",
      "name": "Subscription Handler"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false,
          "disable_web_page_preview": true
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2576,
        -1328
      ],
      "id": "bfbd4d35-2c96-453f-b272-45bb95963905",
      "name": "Telegram1",
      "webhookId": "9284bd4e-4ecc-4aef-870e-ecd34948c2fc",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ‚úÖ SUBSCRIPTION CONFIRMATION HANDLER - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π\nconst input = $input.first();\nconst request = input.json;\nconst chatId = request.chatId;\nconst userName = request.userName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';\nconst confirmationType = request.confirmationType;\nconst matchedPattern = request.matchedPattern;\n\nconsole.log('‚úÖ Processing confirmation:', confirmationType, 'for user:', chatId);\nconsole.log('üìù Matched pattern:', matchedPattern);\n\nswitch(confirmationType) {\n  case 'confirm_subscribe':\n    return [{\n      json: {\n        action: 'subscription_confirmed',\n        chatId: chatId,\n        message: `üéâ **–û—Ç–ª–∏—á–Ω–æ, ${userName}! –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å!**\n\n‚úÖ **–¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å:**\nüåÖ **–£—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–≤–µ—Ç—ã** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 –ú–°–ö\nüåô **–í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 20:00 –ú–°–ö\nüéµ **–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã** —Å —ç—Ñ–∏—Ä–Ω—ã–º–∏ –º–∞—Å–ª–∞–º–∏\n\nüöÄ **–ß—Ç–æ –¥–∞–ª—å—à–µ?**\n‚Ä¢ –ó–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º –ø–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Å–æ–≤–µ—Ç\n‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ \"–º—É–∑—ã–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\" –¥–ª—è –ø—Ä–æ–±–Ω–æ–≥–æ –ø–ª–µ–π–ª–∏—Å—Ç–∞\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏\" –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏\n\nüí° **–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\nüìù \"—Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏\" - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\nüìù \"–æ—Ç–ø–∏—Å–∞—Ç—å—Å—è\" - –æ—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  \nüìù \"–Ω–∞—Å—Ç—Ä–æ–π–∫–∏\" - –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\n\nüåø **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –∞—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏–∏!**`,\n        subscriptionData: {\n          status: 'active',\n          subscribedAt: new Date().toISOString(),\n          preferences: {\n            morning_enabled: true,\n            evening_enabled: true,\n            morning_time: '09:00',\n            evening_time: '20:00',\n            timezone: 'Europe/Moscow',\n            music_enabled: true\n          }\n        }\n      }\n    }];\n    \n  case 'confirm_unsubscribe':\n    return [{\n      json: {\n        action: 'unsubscription_confirmed',\n        chatId: chatId,\n        message: `üòî **–ü–æ–¥–ø–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞**\n\n–í—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.\n\nüíô **–ú—ã –±—É–¥–µ–º —Å–∫—É—á–∞—Ç—å, ${userName}!** \n\nüîÑ **–í—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è:**\nüìù –ù–∞–ø–∏—à–∏—Ç–µ \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\" –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\n\nüåø **–Ø –≤—Å—ë –µ—â—ë –º–æ–≥—É –ø–æ–º–æ—á—å —Å –º–∞—Å–ª–∞–º–∏!**\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ –º–∞—Å–ª–æ\n‚Ä¢ –û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ  \n‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n\n–£–¥–∞—á–∏ –≤–∞–º! üçÄ`,\n        subscriptionData: {\n          status: 'unsubscribed',\n          unsubscribedAt: new Date().toISOString()\n        }\n      }\n    }];\n    \n  case 'request_details':\n    return [{\n      json: {\n        action: 'subscription_details_provided',\n        chatId: chatId,\n        message: `üìö **–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø–æ–¥–ø–∏—Å–∫–µ**\n\nüî¨ **–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**\n‚Ä¢ –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö\n‚Ä¢ –°—Å—ã–ª–∫–∏ –Ω–∞ –Ω–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ PubMed\n‚Ä¢ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–æ–∑–∏—Ä–æ–≤–∫–∏ –∏ —Å–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n‚Ä¢ –£—á—ë—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏–π –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π\n\nüéµ **–£–Ω–∏–∫–∞–ª—å–Ω–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**\n‚Ä¢ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Å–ª–∞\n‚Ä¢ –ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∏—Ç–º–∞ –∏ –∞—Ä–æ–º–∞—Ç–∞\n‚Ä¢ –ü–ª–µ–π–ª–∏—Å—Ç—ã –¥–ª—è —Ä–∞–∑–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º\n\nüìä **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å –ò–ò:**\n‚Ä¢ –ê–Ω–∞–ª–∏–∑ –≤–∞—à–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ —Ä–µ–∞–∫—Ü–∏–π\n‚Ä¢ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–Ω–∞\n‚Ä¢ –£—á—ë—Ç —Å–µ–∑–æ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –ø–æ–≥–æ–¥—ã\n‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π \"21 –¥–µ–Ω—å\"\n\nüéÅ **–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:**\n‚Ä¢ –†–µ—Ü–µ–ø—Ç—ã —Å–º–µ—Å–µ–π –æ—Ç —ç–∫—Å–ø–µ—Ä—Ç–æ–≤\n‚Ä¢ –í–∏–¥–µ–æ-—É—Ä–æ–∫–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é\n‚Ä¢ –°—Ç–∞—Ç—å–∏ –æ –Ω–æ–≤—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö\n‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –∑–∞–∫—Ä—ã—Ç–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É\n\nüîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:**\n‚Ä¢ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–¥–∞–∂ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n‚Ä¢ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏\n‚Ä¢ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ–¥–ø–∏—Å–∫–æ–π\n‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è\n\n‚ùì **–ì–æ—Ç–æ–≤—ã –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å?** \nüìù –ù–∞–ø–∏—à–∏—Ç–µ \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"`,\n        subscriptionData: {\n          detailsRequested: true,\n          requestedAt: new Date().toISOString()\n        }\n      }\n    }];\n    \n  case 'time_settings':\n    return [{\n      json: {\n        action: 'time_settings_request',\n        chatId: chatId,\n        message: `‚è∞ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**\n\nüïò **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**\nüåÖ –£—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 9:00 –ú–°–ö\nüåô –í–µ—á–µ—Ä–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 20:00 –ú–°–ö\nüåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: Europe/Moscow\n\nüéõÔ∏è **–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?**\n\nüìù **–£—Ç—Ä–µ–Ω–Ω–µ–µ –≤—Ä–µ–º—è:** \"—É—Ç—Ä–æ–º –≤ 8:00\" –∏–ª–∏ \"—É—Ç—Ä–æ–º –≤ 10:30\"\nüìù **–í–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è:** \"–≤–µ—á–µ—Ä–æ–º –≤ 19:00\" –∏–ª–∏ \"–≤–µ—á–µ—Ä–æ–º –≤ 21:00\"  \nüìù **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å:** \"—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥\"\nüìù **–¢–æ–ª—å–∫–æ —É—Ç—Ä–æ–º:** \"—É–±—Ä–∞—Ç—å –≤–µ—á–µ—Ä–Ω–∏–µ\"\nüìù **–¢–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–æ–º:** \"—É–±—Ä–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ\"\nüìù **–û—Ç–ª–æ–∂–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É:** \"–ø–æ–∫–∞ –Ω–µ –Ω–∞–¥–æ\"\n\nüí° **–ü—Ä–∏–º–µ—Ä—ã:**\n‚Ä¢ \"—É—Ç—Ä–æ–º –≤ 7:30\" - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ 7:30\n‚Ä¢ \"–≤–µ—á–µ—Ä–æ–º –≤ 22:00\" - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤–µ—á–µ—Ä–Ω–∏–µ –Ω–∞ 22:00\n‚Ä¢ \"—É–±—Ä–∞—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ\" - –æ—Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è`,\n        subscriptionData: {\n          currentSettings: {\n            morning_time: '09:00',\n            evening_time: '20:00',\n            timezone: 'Europe/Moscow'\n          },\n          settingsMode: 'time_adjustment'\n        }\n      }\n    }];\n    \n  case 'music_settings':\n    return [{\n      json: {\n        action: 'music_settings_request',\n        chatId: chatId,\n        message: `üéµ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**\n\nüéß **–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**\n‚úÖ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã\nüéº –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: Spotify, YouTube, Apple Music, –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞\nüé≠ –ñ–∞–Ω—Ä—ã: –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ\n\nüéõÔ∏è **–ß—Ç–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**\n\nüìù **–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:** \"—Ç–æ–ª—å–∫–æ Spotify\" –∏–ª–∏ \"Spotify –∏ YouTube\"\nüìù **–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã:** \"–∫–ª–∞—Å—Å–∏–∫–∞ –∏ —ç–º–±–∏–µ–Ω—Ç\" –∏–ª–∏ \"—Ç–æ–ª—å–∫–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è\"\nüìù **–ò–∑–±–µ–≥–∞—Ç—å –∂–∞–Ω—Ä—ã:** \"–±–µ–∑ —Ä–æ–∫–∞\" –∏–ª–∏ \"–±–µ–∑ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏\"\nüìù **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–æ–≤:** \"–∫–æ—Ä–æ—Ç–∫–∏–µ —Ç—Ä–µ–∫–∏\" –∏–ª–∏ \"–¥–ª–∏–Ω–Ω—ã–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏\"\nüìù **–û—Ç–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É:** \"–±–µ–∑ –º—É–∑—ã–∫–∏\" \nüìù **–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å:** \"–º—É–∑—ã–∫–∞ –Ω–æ—Ä–º\"\n\nüéº **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:**\n‚Ä¢ \"—Ç–æ–ª—å–∫–æ —Å–ø–æ–∫–æ–π–Ω–∞—è –º—É–∑—ã–∫–∞\" - –∫–ª–∞—Å—Å–∏–∫–∞, —ç–º–±–∏–µ–Ω—Ç, –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ –∑–≤—É–∫–∏\n‚Ä¢ \"—ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è –º—É–∑—ã–∫–∞\" - –ø–æ–ø, –¥–∂–∞–∑, –∏–Ω–¥–∏\n‚Ä¢ \"–¥–ª—è –º–µ–¥–∏—Ç–∞—Ü–∏–∏\" - —Ç–∏–±–µ—Ç—Å–∫–∏–µ —á–∞—à–∏, –º–∞–Ω—Ç—Ä—ã, –∑–≤—É–∫–∏ –ø—Ä–∏—Ä–æ–¥—ã`,\n        subscriptionData: {\n          currentMusicSettings: {\n            enabled: true,\n            platforms: ['spotify', 'youtube', 'apple_music', 'yandex_music'],\n            genres: 'all'\n          },\n          settingsMode: 'music_preferences'\n        }\n      }\n    }];\n\n  case 'morning_only':\n    return [{\n      json: {\n        action: 'morning_only_confirmed',\n        chatId: chatId,\n        message: `üåÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!**\n\n‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å **—Ç–æ–ª—å–∫–æ —É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –≤ 9:00 –ú–°–ö\n\nüåô **–í–µ—á–µ—Ä–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã**\n\nüí° **–í–∞—à —Ä–µ–∂–∏–º:**\n‚Ä¢ –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ - —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∏—á–Ω–æ–≥–æ –¥–Ω—è\n‚Ä¢ –ú–∞—Å–ª–∞ –¥–ª—è –±–æ–¥—Ä–æ—Å—Ç–∏, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏–∏  \n‚Ä¢ –ú—É–∑—ã–∫–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ö–æ—Ä–æ—à–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è\n\nüîÑ **–•–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?**\nüìù \"–≤–∫–ª—é—á–∏—Ç—å –≤–µ—á–µ—Ä–Ω–∏–µ\" - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ—á–µ—Ä–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è\nüìù \"–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è\" - –ø–æ–º–µ–Ω—è—Ç—å –≤—Ä–µ–º—è —É—Ç—Ä–µ–Ω–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`,\n        subscriptionData: {\n          morning_enabled: true,\n          evening_enabled: false,\n          morning_time: '09:00',\n          updatedAt: new Date().toISOString()\n        }\n      }\n    }];\n\n  case 'evening_only':\n    return [{\n      json: {\n        action: 'evening_only_confirmed',\n        chatId: chatId,\n        message: `üåô **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!**\n\n‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å **—Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –≤ 20:00 –ú–°–ö\n\nüåÖ **–£—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω—ã**\n\nüí° **–í–∞—à —Ä–µ–∂–∏–º:**\n‚Ä¢ –ö–∞–∂–¥—ã–π –≤–µ—á–µ—Ä - —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è –æ—Ç–¥—ã—Ö–∞\n‚Ä¢ –ú–∞—Å–ª–∞ –¥–ª—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏, —Å–Ω–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n‚Ä¢ –£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞ –¥–Ω—è\n\nüîÑ **–•–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å?**\nüìù \"–≤–∫–ª—é—á–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ\" - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É—Ç—Ä–µ–Ω–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è  \nüìù \"–∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è\" - –ø–æ–º–µ–Ω—è—Ç—å –≤—Ä–µ–º—è –≤–µ—á–µ—Ä–Ω–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π`,\n        subscriptionData: {\n          morning_enabled: false,\n          evening_enabled: true,\n          evening_time: '20:00',\n          updatedAt: new Date().toISOString()\n        }\n      }\n    }];\n\n  case 'cancel_action':\n    return [{\n      json: {\n        action: 'action_cancelled',\n        chatId: chatId,\n        message: `üëå **–•–æ—Ä–æ—à–æ, ${userName}!**\n\n–ù–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ - —è –≤—Å–µ–≥–¥–∞ –∑–¥–µ—Å—å. üòä\n\nüåø **–ê –ø–æ–∫–∞ –º–æ–≥—É –ø–æ–º–æ—á—å —Å –º–∞—Å–ª–∞–º–∏:**\n‚Ä¢ –ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ –º–∞—Å–ª–æ\n‚Ä¢ –û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—É\n‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ \"–ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\" –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã\n\nüí° **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**\nüìù \"–ª–∞–≤–∞–Ω–¥–∞\" - —É–∑–Ω–∞—Ç—å –ø—Ä–æ –º–∞—Å–ª–æ –ª–∞–≤–∞–Ω–¥—ã\nüìù \"—Å—Ç—Ä–µ—Å—Å\" - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞\nüìù \"–º—É–∑—ã–∫–∞ –¥–ª—è —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è\" - –ø–æ–ª—É—á–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç`,\n        subscriptionData: {\n          actionCancelled: true,\n          cancelledAt: new Date().toISOString()\n        }\n      }\n    }];\n\n  default:\n    return [{\n      json: {\n        action: 'unknown_confirmation',\n        chatId: chatId,\n        message: `ü§î **–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å**\n\n–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:\nüìù **–ù–∞–ø–∏—à–∏—Ç–µ:** \"–¥–∞, –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\"\n\n–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ:\nüìù **–ù–∞–ø–∏—à–∏—Ç–µ:** \"—Ä–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ\"\n\n–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ –ø—Ä–æ –ª—é–±–æ–µ —ç—Ñ–∏—Ä–Ω–æ–µ –º–∞—Å–ª–æ! üåø`,\n        subscriptionData: {\n          confirmationType: confirmationType,\n          originalPattern: matchedPattern,\n          needsManualReview: true\n        }\n      }\n    }];\n}\n\n// üîç –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏\nconsole.log('üìä Subscription confirmation processed:', {\n  chatId: chatId,\n  confirmationType: confirmationType,\n  matchedPattern: matchedPattern,\n  userName: userName,\n  timestamp: new Date().toISOString()\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2064,
        -1056
      ],
      "id": "395c4297-277e-47bf-8895-19169e62b20d",
      "name": "Subscription Confirmation Handler\""
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "üéâ –û—Ç–ª–∏—á–Ω–æ, –î–º–∏—Ç—Ä–∏–π! –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å!\n ‚úÖ –¢–µ–ø–µ—Ä—å –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å: \nüåÖ –£—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–≤–µ—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 –ú–°–ö \nüåô –í–µ—á–µ—Ä–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 20:00 –ú–°–ö ...",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2528,
        -1056
      ],
      "id": "498ceb81-9002-498f-8d0c-8573feb9b565",
      "name": "Telegram Response",
      "webhookId": "b8286d60-9989-4518-bd1c-ba4730ba4a35",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "803ae986-eb51-4f99-ad5e-6fc14e7dea52",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "subscription_confirmation",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1808,
        -1040
      ],
      "id": "eab956fb-a914-4661-a1c1-2bd8a022fbb2",
      "name": "Subscription Confirmation Check"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "subscribers",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Smart Router').first().json.chatId }}"
            },
            {
              "keyName": "username",
              "condition": "eq",
              "keyValue": "={{ $('Smart Router').first().json.userName }}"
            },
            {
              "keyName": "first_name",
              "condition": "eq",
              "keyValue": "={{ $('Smart Router').first().json.userName }}"
            },
            {
              "keyName": "updated_at",
              "condition": "eq",
              "keyValue": "={{ new Date().toISOString() }}"
            },
            {
              "keyName": "subscription_date",
              "condition": "eq",
              "keyValue": "={{ new Date().toISOString() }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "is_active",
              "fieldValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2288,
        -1296
      ],
      "id": "c28fbd5c-b9d7-4bea-9f35-1347edc977a9",
      "name": "Update a row",
      "credentials": {
        "supabaseApi": {
          "id": "jyysiKb0eSXuvPiH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "subscribers",
        "filters": {
          "conditions": [
            {
              "keyName": "chat_id",
              "condition": "eq",
              "keyValue": "={{ $('Smart Router').first().json.chatId }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "is_active",
              "fieldValue": "true"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2288,
        -1040
      ],
      "id": "31d7ca84-c7e0-4fe4-9b78-f1e40e1ba332",
      "name": "Update a row1",
      "credentials": {
        "supabaseApi": {
          "id": "jyysiKb0eSXuvPiH",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ece5de98-b146-4eba-82e3-5675c1e79fc0",
              "leftValue": "={{ $json.requestType }}",
              "rightValue": "subscription_info_request",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1776,
        -784
      ],
      "id": "1dd6eed7-a50e-43b7-b75d-f6e3f06a97f2",
      "name": "subscription_info_request"
    },
    {
      "parameters": {
        "jsCode": "// üìö SUBSCRIPTION INFO HANDLER\nconst input = $input.first();\nconst request = input.json;\nconst chatId = request.chatId;\nconst userName = request.userName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';\n\nconsole.log('üìö Providing subscription info for:', chatId);\n\nreturn [{\n  json: {\n    action: 'subscription_info_provided',\n    chatId: chatId,\n    message: `üìö **–ü–æ–¥—Ä–æ–±–Ω–æ –æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö —Å–æ–≤–µ—Ç–∞—Ö, ${userName}:**\n\nü§ñ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞:**\n- –£–º–Ω—ã–π AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è –≥–æ–¥–∞, –ø–æ–≥–æ–¥—É, –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏\n- –ü–æ–¥–±–∏—Ä–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–¥ –≤–∞—à–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏  \n- –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∞—à—É –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è\n\nüì± **–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:**\nüåÖ **–£—Ç—Ä–æ–º (9:00 –ú–°–ö):**\n   ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–µ –º–∞—Å–ª–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–Ω—è\n   ‚Ä¢ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è\n   ‚Ä¢ –ù–∞—É—á–Ω—ã–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤\n\nüåô **–í–µ—á–µ—Ä–æ–º (20:00 –ú–°–ö):**\n   ‚Ä¢ –†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ –∞—Ä–æ–º–∞—Ç—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è\n   ‚Ä¢ –†–µ—Ü–µ–ø—Ç—ã –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–Ω–∞\n   ‚Ä¢ –¢–µ—Ö–Ω–∏–∫–∏ —Å–Ω—è—Ç–∏—è —Å—Ç—Ä–µ—Å—Å–∞ –¥–Ω—è\n\nüéµ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã:**\n   ‚Ä¢ –ú—É–∑—ã–∫–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å –∞—Ä–æ–º–∞—Ç–∞–º–∏\n   ‚Ä¢ –°—Å—ã–ª–∫–∏ –Ω–∞ Spotify, YouTube, Apple Music\n   ‚Ä¢ –ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—á–µ—Ç–∞–Ω–∏—è –∑–≤—É–∫–∞ –∏ –∑–∞–ø–∞—Ö–∞\n\nüìä **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**\n   ‚Ä¢ –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Ü–µ–ª–∏\n   ‚Ä¢ –ò–∑–±–µ–∂–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π\n   ‚Ä¢ –°–µ–∑–æ–Ω–Ω—ã–µ –∏ –ø–æ–≥–æ–¥–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏\n\n‚öôÔ∏è **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**\n   ‚Ä¢ –õ—é–±–æ–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n   ‚Ä¢ –¢–æ–ª—å–∫–æ —É—Ç—Ä–æ, —Ç–æ–ª—å–∫–æ –≤–µ—á–µ—Ä, –∏–ª–∏ –æ–±–∞\n   ‚Ä¢ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –º—É–∑—ã–∫–∏ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏\n   ‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞\n\nüí° **–ê–±—Å–æ–ª—é—Ç–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ!** –ë–µ–∑ —Å–∫—Ä—ã—Ç—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –∏ –Ω–∞–≤—è–∑—ã–≤–∞–Ω–∏—è –ø–æ–∫—É–ø–æ–∫.\n\nüî¨ **–ù–∞—É—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥:** –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö —Å —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏.`,\n\n    keyboard: [\n      [\n        { text: \"‚úÖ –ó–≤—É—á–∏—Ç –æ—Ç–ª–∏—á–Ω–æ! –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è\", callback_data: \"confirm_subscribe\" }\n      ],\n      [\n        { text: \"‚è∞ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\", callback_data: \"time_settings\" },\n        { text: \"üí∞ –¢–æ—á–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ?\", callback_data: \"pricing_question\" }\n      ],\n      [\n        { text: \"üéµ –ü—Ä–∏–º–µ—Ä—ã –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤\", callback_data: \"music_examples\" },\n        { text: \"üî¨ –ù–∞—É—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏\", callback_data: \"science_sources\" }\n      ],\n      [\n        { text: \"‚ùå –ù–µ —Å–µ–π—á–∞—Å\", callback_data: \"main_menu\" }\n      ]\n    ]\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2032,
        -816
      ],
      "id": "32c7d302-c1cf-45f5-9f9b-b701a95bcf25",
      "name": "SUBSCRIPTION INFO HANDLER"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "123",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2480,
        -816
      ],
      "id": "c929b6f4-3670-49d3-9b37-bb51e3859230",
      "name": "Send a text message",
      "webhookId": "2e052f12-dc89-4ca7-b961-46a0b54aa1ed",
      "credentials": {
        "telegramApi": {
          "id": "r86pcb9P39ijiBL9",
          "name": "–≠—Ñ–∏—Ä–Ω—ã–µ –º–∞—Å–ª–∞ "
        }
      }
    },
    {
      "parameters": {
        "operation": "get"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2240,
        -816
      ],
      "id": "81a8a3b9-9e28-4889-8572-f2261946facd",
      "name": "Get a row",
      "credentials": {
        "supabaseApi": {
          "id": "jyysiKb0eSXuvPiH",
          "name": "Supabase account"
        }
      },
      "disabled": true
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Smart Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Matching Oil": {
      "main": [
        [
          {
            "node": "Telegram Sender",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Smart Router": {
      "main": [
        [
          {
            "node": "Admin Security Enhanced\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Direct Search": {
      "main": [
        [
          {
            "node": "Supabase2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "keyword_search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase2": {
      "main": [
        [
          {
            "node": "Filter Matching Oil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "keyword_search": {
      "main": [
        [
          {
            "node": "Get All Oils for AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Default Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get All Oils for AI": {
      "main": [
        [
          {
            "node": "AI Agent –∫–æ–¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Start Command": {
      "main": [
        [
          {
            "node": "Start Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IF Direct Search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent. Fast",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent –∫–æ–¥": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Perplexity": {
      "ai_tool": [
        [
          {
            "node": "AI Agent Perplexity)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "IF Disambiguation": {
      "main": [
        [
          {
            "node": "Disambiguation Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "IF Oil Comparison": {
      "main": [
        [
          {
            "node": "Oil Comparison Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disambiguation Router": {
      "main": [
        [
          {
            "node": "IF Mint",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Pepper",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Sage",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Eucalyptus",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Pixta",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF –º–∞–Ω–¥–∞—Ä–∏–Ω",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF –±–∞–∑–∏–ª–∏–∫",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF –°–∏—Ç—Ä—É—Å",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF –•–æ–ª–∏–¥–µ–π",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF –î–µ—Ä–µ–≤–æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Mint": {
      "main": [
        [
          {
            "node": "Disambiguation Mint (–¥–ª—è –º—è—Ç—ã)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Pepper": {
      "main": [
        [
          {
            "node": "Disambiguation Pepper (–¥–ª—è –ø–µ—Ä—Ü–∞)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Sage": {
      "main": [
        [
          {
            "node": "Disambiguation Sage (–¥–ª—è —à–∞–ª—Ñ–µ—è)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Eucalyptus": {
      "main": [
        [
          {
            "node": "Disambiguation Eucalyptus (–¥–ª—è —ç–≤–∫–∞–ª–∏–ø—Ç–∞)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Pixta": {
      "main": [
        [
          {
            "node": "Disambiguation Pixta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF –º–∞–Ω–¥–∞—Ä–∏–Ω": {
      "main": [
        [
          {
            "node": "Disambiguation –º–∞–Ω–¥–∞—Ä–∏–Ω",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF –±–∞–∑–∏–ª–∏–∫": {
      "main": [
        [
          {
            "node": "Disambiguation basil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF –°–∏—Ç—Ä—É—Å": {
      "main": [
        [
          {
            "node": "Disambiguation –°–∏—Ç—Ä—É—Å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF –•–æ–ª–∏–¥–µ–π": {
      "main": [
        [
          {
            "node": "Disambiguation –•–æ–ª–∏–¥–µ–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF –î–µ—Ä–µ–≤–æ": {
      "main": [
        [
          {
            "node": "Disambiguation –î–µ—Ä–µ–≤–æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "AI Agent Perplexity)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent. Fast",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent Perplexity)": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent. Fast": {
      "main": [
        [
          {
            "node": "Telegram AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent Perplexity)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Admin Security Enhanced\"": {
      "main": [
        [
          {
            "node": "IF Start Command",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Oil Comparison",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Disambiguation",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Subscription Check",
            "type": "main",
            "index": 0
          },
          {
            "node": "Subscription Confirmation Check",
            "type": "main",
            "index": 0
          },
          {
            "node": "subscription_info_request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Subscription Check": {
      "main": [
        [
          {
            "node": "Subscription Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Subscription Handler": {
      "main": [
        [
          {
            "node": "Update a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Subscription Confirmation Handler\"": {
      "main": [
        [
          {
            "node": "Update a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Subscription Confirmation Check": {
      "main": [
        [
          {
            "node": "Subscription Confirmation Handler\"",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row1": {
      "main": [
        [
          {
            "node": "Telegram Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "subscription_info_request": {
      "main": [
        [
          {
            "node": "SUBSCRIPTION INFO HANDLER",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SUBSCRIPTION INFO HANDLER": {
      "main": [
        [
          {
            "node": "Get a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a row": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "5d3582d4-8d6c-4e3a-8ae2-6c06de6f6330",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "50a20d3245a007b322bac617c092362ad914bd86617e47d80b1342883775b33c"
  },
  "id": "UKkyHBafcO7Zxhb7",
  "tags": []
}